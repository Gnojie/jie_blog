> å‘å¸ƒè®¢é˜…æ˜¯ä¸€ç§é€šè¿‡ç¼“å­˜å›è°ƒäº‹ä»¶å»¶åæ‰§è¡Œçš„æ“ä½œ
> 
> æˆ‘ä»¬å¯ä»¥ç®€å•çš„æŠŠè¿™ç§åšæ³•å½“ä½œæ˜¯**è§£è€¦å›è°ƒå‡½æ•°**,åˆ†åˆ«**å®šä¹‰è§¦å‘è€…**ï¼Œ**ç»‘å®šå›è°ƒå‡½æ•°**ï¼Œ**å†æ‰‹åŠ¨è§¦å‘**

æœ‰ç‚¹æˆ‘ä»¬å¤„ç†å¼‚æ­¥äº‹ä»¶é‚£å‘³å„¿

ğŸ‘‡ æˆ‘ä»¬è·Ÿå›è°ƒå‡½æ•°æ¯”è¾ƒæ¥ç†è§£å‘å¸ƒè®¢é˜…æ¨¡å¼å­˜åœ¨çš„æ„ä¹‰
- å›è°ƒå‡½æ•°
  - äº‹ä»¶Aæ‰§è¡Œå®Œä¹‹åè‡ªåŠ¨æ‰§è¡Œäº‹ä»¶B
- è§‚å¯Ÿè€…
  - äº‹ä»¶Aæ‰§è¡Œå®Œä¹‹åï¼Œæ‰‹åŠ¨æ‰§è¡Œå¤šä¸ªäº‹ä»¶
  - å› ä¸ºæ•°æ®ç»“æ„å¯¼è‡´ä¸€ä¸ªå·¥å…·æ–¹æ³• åªèƒ½æœ‰ä¸€ä¸ªè§¦å‘è€…
- å‘å¸ƒè®¢é˜…
  - äº‹ä»¶Aæ‰§è¡Œå®Œä¹‹åï¼Œæ‰‹åŠ¨æ‰§è¡Œå¤šä¸ªäº‹ä»¶
  - å› ä¸ºæ•°æ®ç»“æ„å¯¼è‡´ä¸€ä¸ªå·¥å…·æ–¹æ³• å¯ä»¥æœ‰å¤šä¸ªä¸åŒçš„è§¦å‘è€…

## å®ç°å‘å¸ƒè®¢é˜…

```js
class è°ƒåº¦ä¸­å¿ƒ {
  constructor() {
    this.è®¢é˜…è€…åˆ—è¡¨ = {}
  }
  è®¢é˜…(è®¢é˜…ç‰©,è®¢é˜…è€…) {
    this.è®¢é˜…è€…åˆ—è¡¨[è®¢é˜…ç‰©].push(è®¢é˜…è€…)
  }
  å‘å¸ƒ(è®¢é˜…ç‰©) {
    this.è®¢é˜…è€…åˆ—è¡¨[è®¢é˜…ç‰©].forEach(item => item())
  }
  å–æ¶ˆè®¢é˜…(è®¢é˜…ç‰©) {
    this.è®¢é˜…è€…åˆ—è¡¨[è®¢é˜…ç‰©] = []
  }
}

const è°ƒåº¦ä¸­å¿ƒA = const new è°ƒåº¦ä¸­å¿ƒ()
è°ƒåº¦ä¸­å¿ƒA.è®¢é˜…('a', () => console.lgo('æ”¶åˆ°å‘å¸ƒ'))
è°ƒåº¦ä¸­å¿ƒA.å‘å¸ƒ('a')
```

```js
class Observer {
  constructor() {
    this.message = {} // æ¶ˆæ¯é˜Ÿåˆ—
  }

  $on(type, callback) {
    // å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„æ•°ç»„
    if (!this.message[type]) {
      this.message[type] = [];
    }
    this.message[type].push(callback);
  }

  $off(type, callback) {
    if (!this.message[type]) return;
    // åˆ¤æ–­æ˜¯å¦æœ‰callbackè¿™ä¸ªå‚æ•°
    if (!callback) {
      this.message[type] = undefined;
      return;
    }
    // å¦‚æœæœ‰callback,å°±ä»…ä»…åˆ æ‰callbackè¿™ä¸ªæ¶ˆæ¯(è¿‡æ»¤æ‰è¿™ä¸ªæ¶ˆæ¯æ–¹æ³•)
    this.message[type] = this.message[type].filter((item) => item !== callback);
  }
  $emit(type) {
    if(!this.message[type]) return;
    // æŒ¨ä¸ªæ‰§è¡Œæ¯ä¸€ä¸ªæ¶ˆæ¯çš„å›è°ƒå‡½æ•°callback
    this.message[type].forEach(item => {
      item()
    });
  }
}
const person1 = new Observer();
person1.$on('buy', handlerA);
person1.$on('buy', handlerB);
person1.$on('buy', handlerC);
console.log('person1 :>> ', person1);
person1.$off('buy',handlerC);
console.log('person1 :>> ', person1);
```

## å®ç°è§‚å¯Ÿè€…
> ä¸ªäººè§‰å¾—`è§‚å¯Ÿè€…`å’Œ`å‘å¸ƒè®¢é˜…`æ˜¯ä¸€ä¸ªä¸œè¥¿
> 
> éƒ½æ˜¯é€šè¿‡ç¼“å­˜å›è°ƒäº‹ä»¶å»¶åæ‰§è¡Œ
> 
> åªæ˜¯è§‚å¯Ÿè€…ç®€å•ä¸€ç‚¹çš„`æ•°æ®ç»“æ„`é€ å°±äº†ä¸¤è€…çš„ä¸åŒï¼Œæ€è·¯éƒ½æ˜¯ä¸€æ ·çš„

è§‚å¯Ÿè€…æ˜¯**ä¸€å¯¹å¤š**çš„å…³ç³»ï¼Œå› æ­¤ä¸éœ€è¦ç»´æŠ¤ `{ name1: [callback...]}`ï¼Œè€Œæ˜¯ç›´æ¥äº‹ä»¶æ•°ç»„å°±è¡Œ `[callback1,...]`
å¹¶ä¸”è§¦å‘è®¢é˜…è€…ä¹Ÿä¸éœ€è¦æŒ‡å®š`name`äº†
```js
class å‘å¸ƒè€… {
  constructor() {
    this.è§‚å¯Ÿè€…åˆ—è¡¨ = []
  }
  æ·»åŠ è§‚å¯Ÿè€…(è®¢é˜…è€…) {
    this.è§‚å¯Ÿè€…åˆ—è¡¨.push(è®¢é˜…è€…)
  }
  å‘å¸ƒ() {
    this.è§‚å¯Ÿè€…åˆ—è¡¨.forEach(item => item())
  }
  å–æ¶ˆè§‚å¯Ÿ() {
    this.è§‚å¯Ÿè€…åˆ—è¡¨ = []
  }
}
```

## è®¢é˜…è€…æ˜¯å®ä¾‹æ—¶
åœ¨ ğŸ‘† æˆ‘ä»¬çš„è®¢é˜…è€…ã€è§‚å¯Ÿè€…éƒ½æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°

åœ¨å®é™…åœºæ™¯è®¢é˜…è€…ã€è§‚å¯Ÿè€…æ›´å¯èƒ½æ˜¯ä¸€ä¸ªå®ä¾‹

è¿™æ—¶å€™æˆ‘ä»¬è§„å®šè¿™ä¸ªå®ä¾‹ä¸Šéƒ½å¸¦ç€ä¸€ä¸ª `callback` è®©æˆ‘ä»¬å‘å¸ƒæ—¶è§¦å‘å‡½æ•°å³å¯

å¦‚ğŸ‘‡è§‚å¯Ÿè€…å¸¦ç€ `update` å‡½æ•°
```js
// è§‚å¯Ÿè€…
class Observer {
  constructor(cb){
    if (typeof cb === 'function') {
      this.cb = cb
    } else {
      throw new Error('Observeræ„é€ å™¨å¿…é¡»ä¼ å…¥å‡½æ•°ç±»å‹ï¼')
    }
  }
  update() {
    this.cb()
  }
}

// ç›®æ ‡å¯¹è±¡
class Subject {
  constructor() {
    // ç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨
    this.observerList = []
  }
  addObserver(observer) {
    this.observerList.push(observer)
  }
  notify() {
    this.observerList.forEach(observer => {
      observer.update() // å‘å¸ƒéå†è§¦å‘çš„æ˜¯å®ä¾‹é‡Œçš„update
    })
  }
}

const observerCallback = function() {
  console.log('æˆ‘è¢«é€šçŸ¥äº†')
}
const observer = new Observer(observerCallback)
const subject = new Subject();
subject.addObserver(observer);
subject.notify();
```

## å®ç°EventBus
æˆ‘ä»¬åš `vue` çš„ç»„ä»¶é€šä¿¡æœ‰æ—¶ä¹Ÿä¼šç”¨åˆ° `EventBus`
```js
// ç»„ä»¶a
const Bus = new Vue()
Bus.$on('a', () => console.log('å›è°ƒå‡½æ•°'))

// ç»„ä»¶b
const Bus = new Vue()
Bus.$emit('a')
```

`EventBus` å°±æ˜¯ä¸€ä¸ª**å‘å¸ƒè®¢é˜…**
```js
class Vue {
  constructor() {
    this.events = {}
  }
  $on(type, callback) {
    // å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„æ•°ç»„
    if (!this.events[type]) {
      this.events[type] = [];
    }
    this.events[type].push(callback);
  }
  $emit(type) {
    if(!this.events[type]) return;
    // æŒ¨ä¸ªæ‰§è¡Œæ¯ä¸€ä¸ªæ¶ˆæ¯çš„å›è°ƒå‡½æ•°callback
    this.events[type].forEach(item => {
      item()
    });
  }
}
```

å¦å¤–ï¼ŒDOMçš„äº‹ä»¶å§”æ‰˜(äº‹ä»¶ç›‘å¬`DOM.addEventListener`)å°±æ˜¯ä¸€ç§å‘å¸ƒè®¢é˜…

## å‚è€ƒèµ„æ–™
- [JavaScript æ·±å…¥ç³»åˆ—ä¹‹å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼çš„æ¨¡æ‹Ÿå®ç°](https://github.com/yuanyuanbyte/Blog/issues/127)