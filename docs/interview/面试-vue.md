é»„è€å¸ˆçš„ [vueæŠ€æœ¯æ­ç§˜](https://ustbhuangyi.github.io/vue-analysis/)

> é¢è¯•é¢˜ï¼Œå›ç­”å¯èƒ½ä¸è¯¦ç»†ã€‚è¯¦ç»†åŸç†å’Œå‘æ•£æ€ç»´å¯ä»¥å¦å¼€æ–‡ç« åˆ†æ

## ä»€ä¹ˆæ˜¯ MVVMï¼Ÿæ¯”ä¹‹ MVC æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

> ä¸ç®¡æ˜¯ React è¿˜æ˜¯ Vueï¼Œå®ƒä»¬éƒ½ä¸æ˜¯ MVVM æ¡†æ¶ï¼Œåªæ˜¯æœ‰å€Ÿé‰´ MVVM çš„æ€è·¯

- View å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è§†å›¾
- Model åŒæ ·å¾ˆç®€å•ï¼Œä¸€èˆ¬å°±æ˜¯æœ¬åœ°æ•°æ®å’Œæ•°æ®åº“ä¸­çš„æ•°æ®

`è§†å›¾æ¨¡å‹åŒå‘ç»‘å®š`ï¼Œæ˜¯`Model-View-ViewModel`çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯æŠŠ`MVC`ä¸­çš„`Controller`æ¼”å˜æˆ`ViewModelã€‚`
- `Model`å±‚ä»£è¡¨æ•°æ®æ¨¡å‹
- `View`ä»£è¡¨UIç»„ä»¶
- `ViewModel`æ˜¯`View`å’Œ`Model`å±‚çš„æ¡¥æ¢
æ•°æ®ä¼šç»‘å®šåˆ°`viewModel`å±‚å¹¶è‡ªåŠ¨å°†æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­ï¼Œè§†å›¾å˜åŒ–çš„æ—¶å€™ä¼šé€šçŸ¥`viewModel`å±‚æ›´æ–°æ•°æ®ã€‚ä»¥å‰æ˜¯æ“ä½œDOMç»“æ„æ›´æ–°è§†å›¾ï¼Œç°åœ¨æ˜¯`æ•°æ®é©±åŠ¨è§†å›¾`ã€‚

èƒŒæ™¯
å°†æ•°æ®ç»è¿‡å¤„ç†å±•ç°åˆ°ç”¨æˆ·çœ‹åˆ°çš„è§†å›¾ä¸Šã€‚
ä»è§†å›¾ä¸Šè¯»å–ç”¨æˆ·çš„è¾“å…¥ï¼Œå°†ç”¨æˆ·çš„è¾“å…¥å†™å…¥åˆ°æ•°æ®åº“

å¦‚ä½•å°†æ•°æ®å±•ç¤ºåˆ°è§†å›¾ä¸Šï¼Œç„¶ååˆå¦‚ä½•å°†ç”¨æˆ·çš„è¾“å…¥å†™å…¥åˆ°æ•°æ®ä¸­ï¼Œä¸åŒçš„äººå°±äº§ç”Ÿäº†ä¸åŒçš„çœ‹æ³•ï¼Œä»æ­¤å‡ºç°äº†å¾ˆå¤šç§æ¶æ„è®¾è®¡

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221212151105.png)

ğŸ‘† MVC æ¶æ„é€šå¸¸æ˜¯ä½¿ç”¨æ§åˆ¶å™¨æ›´æ–°æ¨¡å‹ï¼Œè§†å›¾ä»æ¨¡å‹ä¸­è·å–æ•°æ®å»æ¸²æŸ“ã€‚å½“ç”¨æˆ·æœ‰è¾“å…¥æ—¶ï¼Œä¼šé€šè¿‡æ§åˆ¶å™¨å»æ›´æ–°æ¨¡å‹ï¼Œå¹¶ä¸”é€šçŸ¥è§†å›¾è¿›è¡Œæ›´æ–°

ç¼ºé™·: æ§åˆ¶å™¨æ‰¿æ‹…çš„è´£ä»»å¤ªå¤§äº†ï¼Œéšç€é¡¹ç›®æ„ˆåŠ å¤æ‚ï¼Œæ§åˆ¶å™¨ä¸­çš„ä»£ç ä¼šè¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œå¯¼è‡´å‡ºç°ä¸åˆ©äºç»´æŠ¤çš„æƒ…å†µ

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221212151148.png)

ğŸ‘† MVVM æ¶æ„ä¸­ï¼Œå¼•å…¥äº† ViewModel çš„æ¦‚å¿µ

ViewModel åªå…³å¿ƒæ•°æ®å’Œä¸šåŠ¡çš„å¤„ç†ï¼Œä¸å…³å¿ƒ View å¦‚ä½•å¤„ç†æ•°æ®ï¼Œå› ä¸ºviewå·²ç»æ˜¯ç»‘å®šç€è‡ªåŠ¨å˜åŒ–äº†

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒView å’Œ Model éƒ½å¯ä»¥ç‹¬ç«‹å‡ºæ¥ï¼Œä»»ä½•ä¸€æ–¹æ”¹å˜äº†ä¹Ÿä¸ä¸€å®šéœ€è¦æ”¹å˜å¦ä¸€æ–¹ï¼Œå¹¶ä¸”å¯ä»¥å°†ä¸€äº›å¯å¤ç”¨çš„é€»è¾‘æ”¾åœ¨ä¸€ä¸ª ViewModel ä¸­ï¼Œè®©å¤šä¸ª View å¤ç”¨è¿™ä¸ª ViewModel

ä»¥ Vue æ¡†æ¶æ¥ä¸¾ä¾‹ï¼ŒViewModel å°±æ˜¯ç»„ä»¶çš„å®ä¾‹ã€‚View å°±æ˜¯æ¨¡æ¿ï¼ŒModel çš„è¯åœ¨å¼•å…¥ Vuex çš„æƒ…å†µä¸‹æ˜¯å®Œå…¨å¯ä»¥å’Œç»„ä»¶åˆ†ç¦»çš„ã€‚

ä¼˜ç‚¹ï¼š
1.`ä½è€¦åˆ`ã€‚è§†å›¾ï¼ˆViewï¼‰å¯ä»¥ç‹¬ç«‹äºModelå˜åŒ–å’Œä¿®æ”¹ï¼Œä¸€ä¸ªModelå¯ä»¥ç»‘å®šåˆ°ä¸åŒçš„Viewä¸Šï¼Œå½“Viewå˜åŒ–çš„æ—¶å€™Modelå¯ä»¥ä¸å˜åŒ–ï¼Œå½“Modelå˜åŒ–çš„æ—¶å€™Viewä¹Ÿå¯ä»¥ä¸å˜
2.`å¯é‡ç”¨æ€§`ã€‚ä½ å¯ä»¥æŠŠä¸€äº›è§†å›¾é€»è¾‘æ”¾åœ¨ä¸€ä¸ªModelé‡Œé¢ï¼Œè®©å¾ˆå¤šViewé‡ç”¨è¿™æ®µè§†å›¾é€»è¾‘
3.`ç‹¬ç«‹å¼€å‘`ã€‚å¼€å‘äººå‘˜å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å’Œæ•°æ®çš„å¼€å‘(ViewModel)ï¼Œè®¾è®¡äººå‘˜å¯ä»¥ä¸“æ³¨äºé¡µé¢è®¾è®¡
4.`å¯æµ‹è¯•`

é™¤äº†view model viewModel
åœ¨ MVVM ä¸­è¿˜å¼•å…¥äº†ä¸€ä¸ªéšå¼çš„ Binder å±‚ï¼Œå®ç°äº† View å’Œ ViewModel çš„ç»‘å®š

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221212151422.png)

ä»¥ Vue æ¡†æ¶æ¥ä¸¾ä¾‹ï¼Œè¿™ä¸ªéšå¼çš„ Binder å±‚å°±æ˜¯ Vue é€šè¿‡è§£ææ¨¡æ¿ä¸­çš„æ’å€¼å’ŒæŒ‡ä»¤ä»è€Œå®ç° View ä¸ ViewModel çš„ç»‘å®šã€‚

MVVM æœ€é‡è¦çš„å¹¶ä¸æ˜¯é€šè¿‡åŒå‘ç»‘å®šæˆ–è€…å…¶ä»–çš„æ–¹å¼å°† View ä¸ ViewModel ç»‘å®šèµ·æ¥
è€Œæ˜¯é€šè¿‡ ViewModel å°†è§†å›¾ä¸­çš„çŠ¶æ€å’Œç”¨æˆ·çš„è¡Œä¸ºåˆ†ç¦»å‡ºä¸€ä¸ªæŠ½è±¡ï¼Œè¿™æ‰æ˜¯ MVVM çš„ç²¾é«“

## ä»€ä¹ˆæ˜¯ Virtual DOMï¼Ÿä¸ºä»€ä¹ˆ Virtual DOM æ¯”åŸç”Ÿ DOM å¿«ï¼Ÿ

TODO: å•ç‹¬æ·±å…¥è™šæ‹ŸDOMï¼Œä»¥åŠdiffç®—æ³•

æ“ä½œ DOM æ˜¯æ…¢çš„ï¼Œç›¸è¾ƒäº DOM æ¥è¯´ï¼Œæ“ä½œ JS å¯¹è±¡ä¼šå¿«å¾ˆå¤š

é€šè¿‡ JS å¯¹è±¡æ¥æ¨¡æ‹ŸDOMï¼Œå°±å¯ä»¥é€šè¿‡ JS å¯¹è±¡æ¥æ¸²æŸ“å‡ºå¯¹åº”çš„ DOMã€‚

---

ğŸ¤” ä¸ºä»€ä¹ˆæ“ä½œDOMæ…¢ï¼ŸjQueryï¼Ÿ

---

æ“ä½œè™šæ‹ŸDOMï¼Œéš¾ç‚¹åœ¨äºå¦‚ä½•åˆ¤æ–­æ–°æ—§ä¸¤ä¸ª JS å¯¹è±¡çš„æœ€å°å·®å¼‚å¹¶ä¸”å®ç°å±€éƒ¨æ›´æ–° DOM

DOM æ˜¯ä¸€ä¸ªå¤šå‰æ ‘çš„ç»“æ„
å¦‚æœå®Œæ•´çš„å¯¹æ¯”ä¸¤é¢—æ ‘çš„å·®å¼‚ï¼Œéœ€è¦çš„æ—¶é—´å¤æ‚åº¦ä¼šæ˜¯ O(n ^ 3)ï¼Œè¿™ä¸ªå¤æ‚åº¦è‚¯å®šæ˜¯ä¸èƒ½æ¥å—çš„ã€‚

äºæ˜¯ React å›¢é˜Ÿä¼˜åŒ–äº†ç®—æ³•ï¼Œå®ç°äº† O(n) çš„å¤æ‚åº¦æ¥å¯¹æ¯”å·®å¼‚ã€‚
åªå¯¹æ¯”åŒå±‚çš„èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯è·¨å±‚å¯¹æ¯”ï¼Œè¿™ä¹Ÿæ˜¯è€ƒè™‘åˆ°åœ¨å®é™…ä¸šåŠ¡ä¸­å¾ˆå°‘ä¼šå»è·¨å±‚çš„ç§»åŠ¨ DOM å…ƒç´ ã€‚ æ‰€ä»¥åˆ¤æ–­å·®å¼‚çš„ç®—æ³•å°±åˆ†ä¸ºäº†ä¸¤æ­¥
- ä»ä¸Šè‡³ä¸‹ï¼Œä»å·¦å¾€å³éå†å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ ‘çš„æ·±åº¦éå†ï¼Œè¿™ä¸€æ­¥ä¸­ä¼šç»™æ¯ä¸ªèŠ‚ç‚¹æ·»åŠ ç´¢å¼•ï¼Œä¾¿äºæœ€åæ¸²æŸ“å·®å¼‚
  - åˆ¤æ–­æ–°æ—§èŠ‚ç‚¹çš„ tagName æ˜¯å¦ç›¸åŒ
  - å¦‚æœä¸ç›¸åŒçš„è¯å°±ä»£è¡¨èŠ‚ç‚¹è¢«æ›¿æ¢äº†
  - å¦‚æœæ²¡æœ‰æ›´æ”¹ tagName çš„è¯ï¼Œå°±éœ€è¦åˆ¤æ–­æ˜¯å¦æœ‰å­å…ƒç´ ï¼Œæœ‰çš„è¯å°±è¿›è¡Œç¬¬äºŒæ­¥ç®—æ³•
- ä¸€æ—¦èŠ‚ç‚¹æœ‰å­å…ƒç´ ï¼Œå°±å»åˆ¤æ–­å­å…ƒç´ æ˜¯å¦æœ‰ä¸åŒ
  - åˆ¤æ–­åŸæœ¬çš„åˆ—è¡¨ä¸­æ˜¯å¦æœ‰èŠ‚ç‚¹è¢«ç§»é™¤ï¼Œåœ¨æ–°çš„åˆ—è¡¨ä¸­éœ€è¦åˆ¤æ–­æ˜¯å¦æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œè¿˜éœ€è¦åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æœ‰ç§»åŠ¨ã€‚

æœ€å¤§ä¼˜åŠ¿å¹¶ä¸æ˜¯æ“ä½œDOMçš„æ€§èƒ½è€Œæ˜¯
- å°† Virtual DOM ä½œä¸ºä¸€ä¸ªå…¼å®¹å±‚ï¼Œè®©æˆ‘ä»¬è¿˜èƒ½å¯¹æ¥é Web ç«¯çš„ç³»ç»Ÿï¼Œå®ç°è·¨ç«¯å¼€å‘ã€‚
- é€šè¿‡ Virtual DOM æˆ‘ä»¬å¯ä»¥æ¸²æŸ“åˆ°å…¶ä»–çš„å¹³å°ï¼Œæ¯”å¦‚å®ç° SSRã€åŒæ„æ¸²æŸ“ç­‰ç­‰ã€‚
- å®ç°ç»„ä»¶çš„é«˜åº¦æŠ½è±¡åŒ–


## å‰ç«¯è·¯ç”±åŸç†ï¼Ÿä¸¤ç§å®ç°æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

TODO: å•ç‹¬æ·±å…¥å‰ç«¯åº”ç”¨è·¯ç”±åŸç†

> æœ¬è´¨æ˜¯ç›‘å¬ URL çš„å˜åŒ–ï¼Œç„¶ååŒ¹é…è·¯ç”±è§„åˆ™ï¼Œæ˜¾ç¤ºç›¸åº”çš„é¡µé¢ï¼Œå¹¶ä¸”æ— é¡»åˆ·æ–°é¡µé¢

- Hash æ¨¡å¼
  - å½“ # åé¢çš„å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡ hashchange äº‹ä»¶æ¥ç›‘å¬åˆ° URL çš„å˜åŒ–ï¼Œä»è€Œè¿›è¡Œè·³è½¬é¡µé¢
  - `window.addEventListener('hashchange', () => { ... })`
  - æ— è®ºå“ˆå¸Œå€¼å¦‚ä½•å˜åŒ–ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°çš„ URL è¯·æ±‚æ°¸è¿œæ˜¯ # å‰ç«¯çš„åŸŸå
- History æ¨¡å¼
  - ä½¿ç”¨ `history.pushState å’Œ history.replaceState` æ”¹å˜ URL
  - ä¸ä¼šä¼šå¼•èµ·é¡µé¢çš„åˆ·æ–°ï¼Œåªä¼šæ›´æ–°æµè§ˆå™¨çš„å†å²è®°å½•
  - æ–°å¢å†å²è®°å½• `history.pushState(stateObject, title, URL)`
  - æ›¿æ¢å½“å‰å†å²è®°å½•
 `history.replaceState(stateObject, title, URL)`
 - ç›‘å¬æµè§ˆå™¨åé€€äº‹ä»¶ `window.addEventListener('popstate', e => { ... })` 


åŒºåˆ«
- Hash æ¨¡å¼åªå¯ä»¥æ›´æ”¹ # åé¢çš„å†…å®¹ï¼ŒHistory æ¨¡å¼å¯ä»¥é€šè¿‡ API è®¾ç½®ä»»æ„çš„åŒæº URL
- History æ¨¡å¼å¯ä»¥é€šè¿‡ API æ·»åŠ ä»»æ„ç±»å‹çš„æ•°æ®åˆ°å†å²è®°å½•ä¸­ï¼Œ Hash æ¨¡å¼åªèƒ½æ›´æ”¹å“ˆå¸Œå€¼ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²
- Hash æ¨¡å¼æ— éœ€åç«¯é…ç½®ï¼Œå¹¶ä¸”å…¼å®¹æ€§å¥½ã€‚History æ¨¡å¼åœ¨ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥åœ°å€æˆ–è€…åˆ·æ–°é¡µé¢çš„æ—¶å€™ä¼šå‘èµ· URL è¯·æ±‚ï¼Œåç«¯éœ€è¦é…ç½® index.html é¡µé¢ç”¨äºåŒ¹é…ä¸åˆ°é™æ€èµ„æºçš„æ—¶å€™


## Vue å’Œ React ä¹‹é—´çš„åŒºåˆ«

Vue çš„è¡¨å•å¯ä»¥ä½¿ç”¨ v-model æ”¯æŒåŒå‘ç»‘å®šï¼Œç›¸æ¯”äº React æ¥è¯´å¼€å‘ä¸Šæ›´åŠ æ–¹ä¾¿ï¼Œå½“ç„¶äº† v-model å…¶å®å°±æ˜¯ä¸ªè¯­æ³•ç³–ï¼Œæœ¬è´¨ä¸Šå’Œ React å†™è¡¨å•çš„æ–¹å¼æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚

Vue ä¿®æ”¹çŠ¶æ€ç›¸æ¯”æ¥è¯´è¦ç®€å•è®¸å¤šï¼ŒReact éœ€è¦ä½¿ç”¨ setState æ¥æ”¹å˜çŠ¶æ€ï¼Œå¹¶ä¸”ä½¿ç”¨è¿™ä¸ª API ä¹Ÿæœ‰ä¸€äº›å‘ç‚¹ã€‚å¹¶ä¸” Vue çš„åº•å±‚ä½¿ç”¨äº†ä¾èµ–è¿½è¸ªï¼Œé¡µé¢æ›´æ–°æ¸²æŸ“å·²ç»æ˜¯æœ€ä¼˜çš„äº†ï¼Œä½†æ˜¯ React è¿˜æ˜¯éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å»ä¼˜åŒ–è¿™æ–¹é¢çš„é—®é¢˜ã€‚


## ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°

åœ¨ beforeCreate é’©å­å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œæ˜¯è·å–ä¸åˆ° props æˆ–è€… data ä¸­çš„æ•°æ®çš„ï¼Œå› ä¸ºè¿™äº›æ•°æ®çš„åˆå§‹åŒ–éƒ½åœ¨ initState ä¸­ã€‚

æ‰§è¡Œ created é’©å­å‡½æ•°ï¼Œåœ¨è¿™ä¸€æ­¥çš„æ—¶å€™å·²ç»å¯ä»¥è®¿é—®åˆ°ä¹‹å‰ä¸èƒ½è®¿é—®åˆ°çš„æ•°æ®ï¼Œä½†æ˜¯è¿™æ—¶å€™ç»„ä»¶è¿˜æ²¡è¢«æŒ‚è½½ï¼Œæ‰€ä»¥æ˜¯çœ‹ä¸åˆ°çš„ã€‚

æ‰§è¡Œ beforeMount é’©å­å‡½æ•°ï¼Œå¼€å§‹åˆ›å»º VDOM

æ‰§è¡Œ mounted é’©å­ï¼Œå¹¶å°† VDOM æ¸²æŸ“ä¸ºçœŸå® DOM å¹¶ä¸”æ¸²æŸ“æ•°æ®ã€‚ç»„ä»¶ä¸­å¦‚æœæœ‰å­ç»„ä»¶çš„è¯ï¼Œä¼šé€’å½’æŒ‚è½½å­ç»„ä»¶ï¼Œåªæœ‰å½“æ‰€æœ‰å­ç»„ä»¶å…¨éƒ¨æŒ‚è½½å®Œæ¯•ï¼Œæ‰ä¼šæ‰§è¡Œæ ¹ç»„ä»¶çš„æŒ‚è½½é’©å­ã€‚

æ•°æ®æ›´æ–°æ—¶ä¼šè°ƒç”¨çš„é’©å­å‡½æ•° beforeUpdate å’Œ updatedï¼Œåˆ†åˆ«åœ¨æ•°æ®æ›´æ–°å‰å’Œæ›´æ–°åä¼šè°ƒç”¨ã€‚

å¦å¤–è¿˜æœ‰ keep-alive ç‹¬æœ‰çš„ç”Ÿå‘½å‘¨æœŸï¼Œåˆ†åˆ«ä¸º activated å’Œ deactivated ã€‚
ç”¨ keep-alive åŒ…è£¹çš„ç»„ä»¶åœ¨åˆ‡æ¢æ—¶ä¸ä¼šè¿›è¡Œé”€æ¯ï¼Œè€Œæ˜¯ç¼“å­˜åˆ°å†…å­˜ä¸­å¹¶æ‰§è¡Œ deactivated é’©å­å‡½æ•°ï¼Œå‘½ä¸­ç¼“å­˜æ¸²æŸ“åä¼šæ‰§è¡Œ actived é’©å­å‡½æ•°ã€‚

é”€æ¯ç»„ä»¶çš„é’©å­å‡½æ•° beforeDestroy å’Œ destroyedã€‚å‰è€…é€‚åˆç§»é™¤äº‹ä»¶ã€å®šæ—¶å™¨ç­‰ç­‰ï¼Œå¦åˆ™å¯èƒ½ä¼šå¼•èµ·å†…å­˜æ³„éœ²çš„é—®é¢˜ã€‚ç„¶åè¿›è¡Œä¸€ç³»åˆ—çš„é”€æ¯æ“ä½œï¼Œå¦‚æœæœ‰å­ç»„ä»¶çš„è¯ï¼Œä¹Ÿä¼šé€’å½’é”€æ¯å­ç»„ä»¶ï¼Œæ‰€æœ‰å­ç»„ä»¶éƒ½é”€æ¯å®Œæ¯•åæ‰ä¼šæ‰§è¡Œæ ¹ç»„ä»¶çš„ destroyed é’©å­å‡½æ•°ã€‚

## æè¿°Vueç»„ä»¶ç”Ÿå‘½å‘¨æœŸ(çˆ¶å­ç»„ä»¶)
- å•ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå›¾
- çˆ¶å­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå…³ç³»

ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼š
> çˆ¶ç»„ä»¶beforeCreate --> çˆ¶ç»„ä»¶created --> çˆ¶ç»„ä»¶beforeMount --> å­ç»„ä»¶beforeCreate --> å­ç»„ä»¶created --> å­ç»„ä»¶beforeMount --> å­ç»„ä»¶ mounted --> çˆ¶ç»„ä»¶mounted -->çˆ¶ç»„ä»¶beforeUpdate -->å­ç»„ä»¶beforeDestroy--> å­ç»„ä»¶destroyed --> çˆ¶ç»„ä»¶updated

## ç»„ä»¶é€šä¿¡

- çˆ¶å­ç»„ä»¶é€šä¿¡
  - `props`/`$emit`å…¸å‹çš„å•å‘æ•°æ®æµï¼Œçˆ¶ç»„ä»¶é€šè¿‡ props ä¼ é€’æ•°æ®ï¼Œå­ç»„ä»¶ä¸èƒ½ç›´æ¥ä¿®æ”¹ propsï¼Œ è€Œæ˜¯å¿…é¡»é€šè¿‡å‘é€äº‹ä»¶çš„æ–¹å¼å‘ŠçŸ¥çˆ¶ç»„ä»¶ä¿®æ”¹æ•°æ®ã€‚
  - è¯­æ³•ç³– v-model æ¥ç›´æ¥å®ç°ï¼Œå› ä¸º v-model é»˜è®¤ä¼šè§£ææˆåä¸º value çš„ prop å’Œåä¸º input çš„äº‹ä»¶
  - å¯ä»¥é€šè¿‡è®¿é—® $parent æˆ–è€… $children å¯¹è±¡æ¥è®¿é—®ç»„ä»¶å®ä¾‹ä¸­çš„æ–¹æ³•å’Œæ•°æ®
  - `$attrsã€$listeners` å±æ€§ä¼šå°†çˆ¶ç»„ä»¶ä¸­çš„ (ä¸å« .native ä¿®é¥°å™¨çš„) v-on äº‹ä»¶ç›‘å¬å™¨ä¼ é€’ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶å¯ä»¥é€šè¿‡è®¿é—® $listeners æ¥è‡ªå®šä¹‰ç›‘å¬å™¨
  - .sync å±æ€§æ˜¯ä¸ªè¯­æ³•ç³– ` @update:value="v => value = v"` `this.$emit('update:value', 1)`
- å…„å¼Ÿç»„ä»¶é€šä¿¡
  - `this.$parent.$children`ï¼Œåœ¨ `$children` ä¸­å¯ä»¥é€šè¿‡ç»„ä»¶ `name` æŸ¥è¯¢åˆ°éœ€è¦çš„ç»„ä»¶å®ä¾‹ï¼Œè¿›è¡Œé€šä¿¡
- è·¨å¤šå±‚çº§ç»„ä»¶é€šä¿¡
  - provide / inject
- ä»»æ„ç»„ä»¶
  -  Vuex
  -  Event Bus 

## extend èƒ½åšä»€ä¹ˆ

ä½œç”¨æ˜¯æ‰©å±•ç»„ä»¶ç”Ÿæˆä¸€ä¸ªæ„é€ å™¨ï¼Œé€šå¸¸ä¼šä¸ $mount ä¸€èµ·ä½¿ç”¨ã€‚

```js
// åˆ›å»ºç»„ä»¶æ„é€ å™¨
let Component = Vue.extend({
  template: '<div>test</div>'
})
// æŒ‚è½½åˆ° #app ä¸Š
new Component().$mount('#app')
```


é™¤äº†ä¸Šé¢çš„æ–¹å¼ï¼Œè¿˜å¯ä»¥ç”¨æ¥æ‰©å±•å·²æœ‰çš„ç»„ä»¶
```js
let SuperComponent = Vue.extend(Component)
new SuperComponent({
    created() {
        console.log(1)
    }
})
new SuperComponent().$mount('#app')
```

## mixin å’Œ mixins åŒºåˆ«

mixin ç”¨äºå…¨å±€æ··å…¥ï¼Œä¼šå½±å“åˆ°æ¯ä¸ªç»„ä»¶å®ä¾‹ï¼Œé€šå¸¸æ’ä»¶éƒ½æ˜¯è¿™æ ·åšåˆå§‹åŒ–çš„
```js
Vue.mixin({
 beforeCreate() {
  // ...é€»è¾‘
  // è¿™ç§æ–¹å¼ä¼šå½±å“åˆ°æ¯ä¸ªç»„ä»¶çš„ beforeCreate é’©å­å‡½æ•°
 }
})
```
mixins ç”¨äºå±€éƒ¨æ··å…¥ä»£ç ï¼Œæ¯”å¦‚ä¸Šæ‹‰ä¸‹æ‹‰åŠ è½½æ•°æ®è¿™ç§é€»è¾‘ç­‰ç­‰ã€‚

æ³¨æ„ï¼š mixins æ··å…¥çš„é’©å­å‡½æ•°ä¼šå…ˆäºç»„ä»¶å†…çš„é’©å­å‡½æ•°æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨é‡åˆ°åŒåé€‰é¡¹çš„æ—¶å€™ä¹Ÿä¼šæœ‰é€‰æ‹©æ€§çš„è¿›è¡Œåˆå¹¶

## computed å’Œ watch åŒºåˆ«

TODO: åŸç† é‡å­¦vue-computed/watch

é€šä¿—æ¥è®²ï¼Œæ—¢èƒ½ç”¨ computed å®ç°åˆå¯ä»¥ç”¨ watch ç›‘å¬æ¥å®ç°çš„åŠŸèƒ½ï¼Œæ¨èç”¨ computed

é‡ç‚¹åœ¨äº computed çš„ç¼“å­˜åŠŸèƒ½ computed è®¡ç®—å±æ€§æ˜¯ç”¨æ¥å£°æ˜å¼çš„æè¿°ä¸€ä¸ªå€¼ä¾èµ–äº†å…¶å®ƒçš„å€¼ï¼Œå½“æ‰€ä¾èµ–çš„å€¼æˆ–è€…å˜é‡ æ”¹å˜æ—¶ï¼Œè®¡ç®—å±æ€§ä¹Ÿä¼šè·Ÿç€æ”¹å˜

watch ç›‘å¬çš„æ˜¯å·²ç»åœ¨ data ä¸­å®šä¹‰çš„å˜é‡ï¼Œå½“è¯¥å˜é‡å˜åŒ–æ—¶ï¼Œä¼šè§¦å‘ watch ä¸­çš„æ–¹æ³•ã€‚

**watch å±æ€§ç›‘å¬** æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé”®æ˜¯éœ€è¦è§‚å¯Ÿçš„å±æ€§ï¼Œå€¼æ˜¯å¯¹åº”å›è°ƒå‡½æ•°ï¼Œä¸»è¦ç”¨æ¥ç›‘å¬æŸäº›ç‰¹å®šæ•°æ®çš„å˜åŒ–ï¼Œä»è€Œè¿›è¡ŒæŸäº›å…·ä½“çš„ä¸šåŠ¡é€»è¾‘æ“ä½œ,ç›‘å¬å±æ€§çš„å˜åŒ–ï¼Œéœ€è¦åœ¨æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå¼‚æ­¥æˆ–å¼€é”€è¾ƒå¤§çš„æ“ä½œæ—¶ä½¿ç”¨

**computed è®¡ç®—å±æ€§** å±æ€§çš„ç»“æœä¼šè¢«`ç¼“å­˜`ï¼Œå½“`computed`ä¸­çš„å‡½æ•°æ‰€ä¾èµ–çš„å±æ€§æ²¡æœ‰å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œé‚£ä¹ˆè°ƒç”¨å½“å‰å‡½æ•°çš„æ—¶å€™ç»“æœä¼šä»ç¼“å­˜ä¸­è¯»å–ã€‚é™¤éä¾èµ–çš„å“åº”å¼å±æ€§å˜åŒ–æ—¶æ‰ä¼šé‡æ–°è®¡ç®—ï¼Œä¸»è¦å½“åšå±æ€§æ¥ä½¿ç”¨ `computed`ä¸­çš„å‡½æ•°å¿…é¡»ç”¨`return`è¿”å›æœ€ç»ˆçš„ç»“æœ `computed`æ›´é«˜æ•ˆï¼Œä¼˜å…ˆä½¿ç”¨ã€‚`data ä¸æ”¹å˜ï¼Œcomputed ä¸æ›´æ–°ã€‚`

**ä½¿ç”¨åœºæ™¯** `computed`ï¼šå½“ä¸€ä¸ªå±æ€§å—å¤šä¸ªå±æ€§å½±å“çš„æ—¶å€™ä½¿ç”¨ï¼Œä¾‹ï¼šè´­ç‰©è½¦å•†å“ç»“ç®—åŠŸèƒ½ `watch`ï¼šå½“ä¸€æ¡æ•°æ®å½±å“å¤šæ¡æ•°æ®çš„æ—¶å€™ä½¿ç”¨ï¼Œä¾‹ï¼šæœç´¢æ•°æ®

## v-show ä¸ v-if åŒºåˆ«
v-show åªæ˜¯åœ¨ `display: none` å’Œ `display: block` ä¹‹é—´åˆ‡æ¢ã€‚æ— è®ºåˆå§‹æ¡ä»¶æ˜¯ä»€ä¹ˆéƒ½ä¼šè¢«æ¸²æŸ“å‡ºæ¥ï¼Œåé¢åªéœ€è¦åˆ‡æ¢ CSSï¼ŒDOM è¿˜æ˜¯ä¸€ç›´ä¿ç•™ç€çš„ã€‚æ‰€ä»¥æ€»çš„æ¥è¯´ v-show åœ¨åˆå§‹æ¸²æŸ“æ—¶æœ‰æ›´é«˜çš„å¼€é”€ï¼Œä½†æ˜¯åˆ‡æ¢å¼€é”€å¾ˆå°ï¼Œæ›´é€‚åˆäºé¢‘ç¹åˆ‡æ¢çš„åœºæ™¯ã€‚

v-if æ§åˆ¶ Vue åº•å±‚çš„ç¼–è¯‘ã€‚å½“å±æ€§åˆå§‹ä¸º false æ—¶ï¼Œç»„ä»¶å°±ä¸ä¼šè¢«æ¸²æŸ“ï¼Œç›´åˆ°æ¡ä»¶ä¸º trueï¼Œå¹¶ä¸”åˆ‡æ¢æ¡ä»¶æ—¶ä¼šè§¦å‘é”€æ¯/æŒ‚è½½ç»„ä»¶ï¼Œæ‰€ä»¥æ€»çš„æ¥è¯´åœ¨åˆ‡æ¢æ—¶å¼€é”€æ›´é«˜ï¼Œæ›´é€‚åˆä¸ç»å¸¸åˆ‡æ¢çš„åœºæ™¯ã€‚

å¯ä»¥åŸºäº v-if å®ç°æƒ°æ€§æ¸²æŸ“æœºåˆ¶ï¼Œå¦‚å±€éƒ¨éª¨æ¶ç­‰åœ¨å¿…è¦çš„æ—¶å€™æ‰å»æ¸²æŸ“ç»„ä»¶ï¼Œå‡å°‘æ•´ä¸ªé¡µé¢çš„åˆå§‹æ¸²æŸ“å¼€é”€ã€‚

## ç»„ä»¶ä¸­ data ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨å¯¹è±¡

è€ƒçš„æ˜¯ JS åŠŸåº•

ç»„ä»¶å¤ç”¨æ—¶æ‰€æœ‰ç»„ä»¶å®ä¾‹éƒ½ä¼šå…±äº« dataï¼Œå¦‚æœ data æ˜¯å¯¹è±¡çš„è¯ï¼Œå°±ä¼šé€ æˆä¸€ä¸ªç»„ä»¶ä¿®æ”¹ data ä»¥åä¼šå½±å“åˆ°å…¶ä»–æ‰€æœ‰ç»„ä»¶ï¼Œæ‰€ä»¥éœ€è¦å°† data å†™æˆå‡½æ•°ï¼Œæ¯æ¬¡ç”¨åˆ°å°±è°ƒç”¨ä¸€æ¬¡å‡½æ•°è·å¾—æ–°çš„æ•°æ®ã€‚æ·±æµ…æ‹·è´

å½“æˆ‘ä»¬ä½¿ç”¨ new Vue() çš„æ–¹å¼çš„æ—¶å€™ï¼Œæ— è®ºæˆ‘ä»¬å°† data è®¾ç½®ä¸ºå¯¹è±¡è¿˜æ˜¯å‡½æ•°éƒ½æ˜¯å¯ä»¥çš„ï¼Œå› ä¸º new Vue() çš„æ–¹å¼æ˜¯ç”Ÿæˆä¸€ä¸ªæ ¹ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ä¸ä¼šå¤ç”¨ï¼Œä¹Ÿå°±ä¸å­˜åœ¨å…±äº« data çš„æƒ…å†µäº†

## å“åº”å¼åŸç†(æ•°æ®å˜åŒ–ï¼Œè§†å›¾è‡ªåŠ¨å˜åŒ–)

Object.defineProperty() ç›‘å¬å¯¹è±¡å±æ€§ set å’Œ get çš„äº‹ä»¶

```js
var data = { name: 'will be observer' }
observe(data)

let name = data.name // -> get value
data.name = 'yyy' // -> change value
```

```js
// é€’å½’è‡ªèº«
function observe(obj) {
  // åˆ¤æ–­ç±»å‹
  if (!obj || typeof obj !== 'object') {
    return
  }
  Object.keys(obj).forEach(key => {
    defineReactive(obj, key, obj[key])
  })
}

function defineReactive(obj, key, val) {
  // é€’å½’å­å±æ€§
  observe(val)
  Object.defineProperty(obj, key, {
    // å¯æšä¸¾
    enumerable: true,
    // å¯é…ç½®
    configurable: true,
    // è‡ªå®šä¹‰å‡½æ•°
    get: function reactiveGetter() {
      console.log('get value')
      return val
    },
    set: function reactiveSetter(newVal) {
      console.log('change value')
      val = newVal
    }
  })
}
```

ğŸ‘† å®ç°äº†ç›‘å¬å±æ€§çš„get setäº‹ä»¶ï¼Œå¹¶æ’å…¥äº†ä¸€å¥ `console.log`

å†å®ç°ä¸€ä¸ªæ´¾å‘é€šçŸ¥ç”¨çš„ä¸­å¤®æ§åˆ¶å±‚

```js
// é€šè¿‡ Dep è§£è€¦å±æ€§çš„ä¾èµ–å’Œæ›´æ–°æ“ä½œ
class Dep {
  constructor() {
    this.subs = []
  }
  // æ·»åŠ ä¾èµ–
  addSub(sub) {
    this.subs.push(sub)
  }
  // æ›´æ–°
  notify() {
    this.subs.forEach(sub => {
      sub.update()
    })
  }
}
// å…¨å±€å±æ€§ï¼Œé€šè¿‡è¯¥å±æ€§é…ç½® Watcher
Dep.target = null
```
ğŸ‘† subæ•°ç»„é¡¹ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‹¥æœ‰`updateå‡½æ•°`


æœ‰äº†ä¸­å¤®æ§åˆ¶å±‚ï¼Œéœ€è¦çŸ¥é“å“ªäº›è§†å›¾DOMä¾èµ–åˆ°äº†å¯¹åº”çš„æ•°æ®
å³
1. æ ¹æ®æ¨¡ç‰ˆè¯­æ³•`{{}}`ä½¿ç”¨åˆ°çš„å˜é‡åæŸ¥æ‰¾domå¯¹åº”çš„æ•°æ®å±æ€§ï¼Œå¹¶å½¢æˆå…³è”å…³ç³»ï¼Œå­˜å‚¨åˆ°ä¸­å¤®æ§åˆ¶å±‚
2. æ•°æ®å˜åŒ–ï¼Œè§¦å‘ä¸­å¤®æ§åˆ¶å±‚ä¿®æ”¹æ•°æ®å¯¹åº”çš„dom

åœ¨ç»„ä»¶æŒ‚è½½æ—¶ï¼Œä¼šå…ˆå¯¹æ‰€æœ‰éœ€è¦çš„å±æ€§è°ƒç”¨ Object.defineProperty()ï¼Œç„¶åå®ä¾‹åŒ– Watcherï¼Œä¼ å…¥ç»„ä»¶æ›´æ–°çš„å›è°ƒã€‚åœ¨å®ä¾‹åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹æ¨¡æ¿ä¸­çš„å±æ€§è¿›è¡Œæ±‚å€¼ï¼Œè§¦å‘ä¾èµ–æ”¶é›†ã€‚

ğŸ‘‡ è·³è¿‡æ€ä¹ˆå®ç°æ¨¡ç‰ˆè¯­æ³•å¯¹åº”æ•°æ®ï¼Œè¿™æ˜¯æ¯ä¸ªæ¨¡æ¿è¯­æ³•ä¼šè§¦å‘çš„ç±»
```js
class Watcher {
  constructor(obj, key, cb) {
    // å°† Dep.target æŒ‡å‘è‡ªå·±
    // ç„¶åè§¦å‘å±æ€§çš„ getter æ·»åŠ ç›‘å¬
    // æœ€åå°† Dep.target ç½®ç©º
    Dep.target = this
    this.cb = cb
    this.obj = obj
    this.key = key
    this.value = obj[key]
    Dep.target = null
  }
  update() {
    // è·å¾—æ–°å€¼
    this.value = this.obj[this.key]
    // è°ƒç”¨ update æ–¹æ³•æ›´æ–° Dom
    this.cb(this.value)
  }
}
```
ğŸ‘† æ‰§è¡Œæ„é€ å‡½æ•°çš„æ—¶å€™å°† Dep.target æŒ‡å‘è‡ªèº«ï¼Œä»è€Œä½¿å¾—æ”¶é›†åˆ°äº†å¯¹åº”çš„ Watcherï¼Œåœ¨æ´¾å‘æ›´æ–°çš„æ—¶å€™å–å‡ºå¯¹åº”çš„ Watcher ç„¶åæ‰§è¡Œ update å‡½æ•°ã€‚


getå’Œsetè§¦å‘çš„äº‹ä»¶æ”¹ä¸ºä¼ å…¥ä¸­å¤®æ§åˆ¶å±‚
```js
function defineReactive(obj, key, val) {
  // é€’å½’å­å±æ€§
  observe(val)
  let dp = new Dep() // 1. åˆ›å»ºä¸­å¤®æ§åˆ¶å±‚
  Object.defineProperty(obj, key, {
    // å¯æšä¸¾
    enumerable: true,
    // å¯é…ç½®
    configurable: true,
    // è‡ªå®šä¹‰å‡½æ•°
    get: function reactiveGetter() {
      console.log('get value')
      // 2. å°† Watcher æ·»åŠ åˆ°è®¢é˜…
      if (Dep.target) {
        dp.addSub(Dep.target)
      }
      return val
    },
    set: function reactiveSetter(newVal) {
      console.log('change value')
      val = newVal
      // 3. æ‰§è¡Œ watcher çš„ update æ–¹æ³•
      dp.notify()
    }
  })
}
```


```js
var data = { name: 'yck' }

// åˆå§‹åŒ–æ•°æ®ä¸domçš„å…³è”
observe(data)
function update(value) {
  document.querySelector('div').innerText = value
}
// æ¨¡æ‹Ÿè§£æåˆ° `{{name}}` è§¦å‘çš„æ“ä½œ
new Watcher(data, 'name', update)

// è§¦å‘æ¸²æŸ“ update Dom innerText 
data.name = 'yyy' 
```


## Object.defineProperty çš„ç¼ºé™·

- é€šè¿‡ä¸‹æ ‡æ–¹å¼ä¿®æ”¹æ•°ç»„æ•°æ®
- å¯¹è±¡æ–°å¢å±æ€§
- ğŸ‘† ä¸ä¼šè§¦å‘æ•°æ®å˜åŒ–çš„é€šçŸ¥
- å› ä¸º Object.defineProperty ä¸èƒ½æ‹¦æˆªåˆ°è¿™äº›æ“ä½œ
- æ›´ç²¾ç¡®çš„æ¥è¯´ï¼Œå¯¹äºæ•°ç»„è€Œè¨€ï¼Œå¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯æ‹¦æˆªä¸åˆ°çš„

è§£å†³ç›‘å¬ä¸åˆ°ä¸‹æ ‡ä¿®æ”¹æ•°ç»„é¡¹/å¯¹è±¡é—®é¢˜
ğŸ‘‡ æä¾›ä¸€ä¸ª `$setå‡½æ•°`
```ts
export function set (target: Array<any> | Object, key: any, val: any): any {
  // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„ä¸”ä¸‹æ ‡æ˜¯å¦æœ‰æ•ˆ
  if (Array.isArray(target) && isValidArrayIndex(key)) {
    // è°ƒç”¨ splice å‡½æ•°è§¦å‘æ´¾å‘æ›´æ–°
    // è¯¥å‡½æ•°å·²è¢«é‡å†™
    target.length = Math.max(target.length, key)
    target.splice(key, 1, val)
    return val
  }
  // åˆ¤æ–­ key æ˜¯å¦å·²ç»å­˜åœ¨
  if (key in target && !(key in Object.prototype)) {
    target[key] = val
    return val
  }
  const ob = target.__ob__
  // å¦‚æœå¯¹è±¡ä¸æ˜¯å“åº”å¼å¯¹è±¡ï¼Œå°±èµ‹å€¼è¿”å›
  if (!ob) {
    target[key] = val
    return val
  }
  // è¿›è¡ŒåŒå‘ç»‘å®š
  defineReactive(ob.value, key, val)
  // æ‰‹åŠ¨æ´¾å‘æ›´æ–°
  ob.dep.notify()
  return val
}
```

é‡å†™æ•°ç»„æ–¹æ³•ï¼Œè§¦å‘å˜åŒ–é€šçŸ¥
```js
// è·å¾—æ•°ç»„åŸå‹
const arrayProto = Array.prototype
export const arrayMethods = Object.create(arrayProto)
// é‡å†™ä»¥ä¸‹å‡½æ•°
const methodsToPatch = [
  'push',
  'pop',
  'shift',
  'unshift',
  'splice',
  'sort',
  'reverse'
]
methodsToPatch.forEach(function (method) {
  // ç¼“å­˜åŸç”Ÿå‡½æ•°
  const original = arrayProto[method]
  // é‡å†™å‡½æ•°
  def(arrayMethods, method, function mutator (...args) {
  // å…ˆè°ƒç”¨åŸç”Ÿå‡½æ•°è·å¾—ç»“æœ
    const result = original.apply(this, args)
    const ob = this.__ob__
    let inserted
    // è°ƒç”¨ä»¥ä¸‹å‡ ä¸ªå‡½æ•°æ—¶ï¼Œç›‘å¬æ–°æ•°æ®
    switch (method) {
      case 'push':
      case 'unshift':
        inserted = args
        break
      case 'splice':
        inserted = args.slice(2)
        break
    }
    if (inserted) ob.observeArray(inserted)
    // æ‰‹åŠ¨æ´¾å‘æ›´æ–°
    ob.dep.notify()
    return result
  })
})
```


## ç¼–è¯‘è¿‡ç¨‹

æŒ‡vueæ–‡ä»¶çš„htmléƒ¨åˆ†æ¨¡æ¿()ä»£ç æ€ä¹ˆç¼–è¯‘æˆçœŸå®DOMçš„

- å°†æ¨¡æ¿è§£æä¸º AST
- ä¼˜åŒ– AST
- å°† AST è½¬æ¢ä¸º render å‡½æ•°
- ğŸ‘† ç¼–è¯‘æ—¶
- ğŸ‘‡ æµè§ˆå™¨è¿è¡Œæ—¶
- æ‰§è¡Œ render å‡½æ•°ç”Ÿæˆ Virtual DOM
- æ˜ å°„ä¸ºçœŸå® DOM

## NextTick åŸç†åˆ†æ

TODO: é‡å­¦vue-nextTick

> `nextTick`æ˜¯`Vue`æä¾›çš„ä¸€ä¸ªå…¨å±€`API`,æ˜¯åœ¨ä¸‹æ¬¡`DOM`æ›´æ–°å¾ªç¯ç»“æŸä¹‹åæ‰§è¡Œå»¶è¿Ÿå›è°ƒï¼Œåœ¨ä¿®æ”¹æ•°æ®ä¹‹åä½¿ç”¨`$nextTick`ï¼Œåˆ™å¯ä»¥åœ¨å›è°ƒä¸­è·å–æ›´æ–°åçš„`DOM`ï¼›

1. Vueåœ¨æ›´æ–° `DOM` æ—¶æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚åªè¦ä¾¦å¬åˆ°æ•°æ®å˜åŒ–ï¼Œ`Vue`å°†å¼€å¯1ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ç¼“å†²åœ¨åŒä¸€äº‹ä»¶å¾ªç¯ä¸­å‘ç”Ÿçš„æ‰€æœ‰æ•°æ®å˜æ›´ã€‚å¦‚æœåŒä¸€ä¸ª`watcher`è¢«å¤šæ¬¡è§¦å‘ï¼Œåªä¼šè¢«æ¨å…¥åˆ°é˜Ÿåˆ—ä¸­-æ¬¡ã€‚è¿™ç§åœ¨ç¼“å†²æ—¶å»é™¤é‡å¤æ•°æ®å¯¹äºé¿å…ä¸å¿…è¦çš„è®¡ç®—å’Œ`DOM`æ“ä½œæ˜¯éå¸¸é‡è¦çš„ã€‚`nextTick`æ–¹æ³•ä¼šåœ¨é˜Ÿåˆ—ä¸­åŠ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç¡®ä¿è¯¥å‡½æ•°åœ¨å‰é¢çš„domæ“ä½œå®Œæˆåæ‰è°ƒç”¨ï¼›
1. æ¯”å¦‚ï¼Œæˆ‘åœ¨å¹²ä»€ä¹ˆçš„æ—¶å€™å°±ä¼šä½¿ç”¨ `nextTick` ï¼Œä¼ ä¸€ä¸ªå›è°ƒå‡½æ•°è¿›å»ï¼Œåœ¨é‡Œé¢æ‰§è¡Œdomæ“ä½œå³å¯ï¼›
1. æˆ‘ä¹Ÿæœ‰ç®€å•äº†è§£`nextTick`å®ç°ï¼Œå®ƒä¼šåœ¨`callbacks`é‡Œé¢åŠ å…¥æˆ‘ä»¬ä¼ å…¥çš„å‡½æ•°ï¼Œç„¶åç”¨`timerFunc`å¼‚æ­¥æ–¹å¼è°ƒç”¨å®ƒä»¬ï¼Œé¦–é€‰çš„å¼‚æ­¥æ–¹å¼ä¼šæ˜¯`Promise`ã€‚è¿™è®©æˆ‘æ˜ç™½äº†ä¸ºä»€ä¹ˆå¯ä»¥åœ¨`nextTick`ä¸­çœ‹åˆ°`dom`æ“ä½œç»“æœã€‚

Vue 2.4 ä¹‹å‰éƒ½æ˜¯ä½¿ç”¨çš„ `microtasks`
ä½†æ˜¯ `microtasks` çš„ä¼˜å…ˆçº§è¿‡é«˜
åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šå‡ºç°æ¯”äº‹ä»¶å†’æ³¡æ›´å¿«çš„æƒ…å†µ

ä½†å¦‚æœéƒ½ä½¿ç”¨ `microtasks` åˆå¯èƒ½ä¼šå‡ºç°æ¸²æŸ“çš„æ€§èƒ½é—®é¢˜ã€‚æ‰€ä»¥åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œä¼šé»˜è®¤ä½¿ç”¨ `microtasks`
ä½†åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ä¼šä½¿ç”¨ `macrotasks`ï¼Œæ¯”å¦‚ `v-on`

æ ¹æ®æ‰§è¡Œç¯å¢ƒåˆ†åˆ«å°è¯•é‡‡ç”¨ `Promiseã€MutationObserverã€setImmediate` ï¼Œå¦‚æœä»¥ä¸Šéƒ½ä¸è¡Œåˆ™é‡‡ç”¨ `setTimeout` å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå¤šæ¬¡è°ƒç”¨ `nextTick` ä¼šå°†æ–¹æ³•å­˜å…¥é˜Ÿåˆ—ä¸­ï¼Œé€šè¿‡è¿™ä¸ªå¼‚æ­¥æ–¹æ³•æ¸…ç©ºå½“å‰é˜Ÿåˆ—ã€‚

```js
if (typeof setImmediate !== 'undefined' && isNative(setImmediate)) {
  macroTimerFunc = () => {
    setImmediate(flushCallbacks)
  }
} else if (
  typeof MessageChannel !== 'undefined' &&
  (isNative(MessageChannel) ||
    // PhantomJS
    MessageChannel.toString() === '[object MessageChannelConstructor]')
) {
  const channel = new MessageChannel()
  const port = channel.port2
  channel.port1.onmessage = flushCallbacks
  macroTimerFunc = () => {
    port.postMessage(1)
  }
} else {
  macroTimerFunc = () => {
    setTimeout(flushCallbacks, 0)
  }
}
```

## v-forä¸ºä»€ä¹ˆè¦ç”¨key
- forç”¨çš„keyä¸èƒ½æ˜¯ index å’Œå”¯ä¸€éšæœºå€¼
- diffç®—æ³•é€šè¿‡é€‰æ‹©å™¨å­—ç¬¦ä¸²å’Œkeyæ¥åˆ¤æ–­æ˜¯å¦ sameNode
- ç”¨keyæ–¹ä¾¿diffç®—æ³•ï¼Œåšåˆ°å‡å°‘æ¸²æŸ“æ¬¡æ•°ï¼Œæå‡æ¸²æŸ“æ€§èƒ½



## æè¿°ç»„ä»¶æ¸²æŸ“å’Œæ›´æ–°è¿‡ç¨‹/è¯·æè¿°å“åº”å¼åŸç†
- å®˜æ–¹æ–‡æ¡£å›¾ç¤º
- åŒ…å«æ¨¡ç‰ˆæ¸²æŸ“æˆè™šæ‹Ÿdomã€æ•°æ®åŒå‘ç»‘å®šçš„getsetæ‹¦æˆªå’Œè§‚å¯Ÿã€æ›´æ–°è™šæ‹ŸdomæˆçœŸå®domçš„diffç®—æ³•

## v-modelçš„å®ç°
- inputå…ƒç´ çš„`value = this.xxx`
- ç»‘å®šinputäº‹ä»¶ `this.xxx = $even.target.value`
- dataæ›´æ–°å‡ºå‘re-render

## computedçš„ç‰¹ç‚¹
- æœ‰ç¼“å­˜ï¼Œdataä¸å˜ä¸ä¼šé‡æ–°è®¡ç®—(å¯ä»¥çœ‹çœ‹æ˜¯æ€ä¹ˆå®ç°çš„)
- æé«˜æ€§èƒ½

## ç»„ä»¶dataä¸ºä»€ä¹ˆå¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°
- æ¯ä¸ªvueæ–‡ä»¶éƒ½ä¼šç¼–è¯‘åˆ°åŒä¸€ä¸ªvueå®ä¾‹ä¸‹ï¼Œå¤šä¸ªç»„ä»¶çš„å±æ€§å¦‚æœæ˜¯å¯¹è±¡ä¼šäº’ç›¸å¹²æ‰°ï¼Œå‡½æ•°åˆ™ä¼šæ˜¯ä¸€ä¸ªé—­åŒ…

## ä½•æ—¶éœ€è¦ç”¨åˆ°beforeDestory
- è§£é™¤eventbusè‡ªå®šä¹‰äº‹ä»¶æ—¶ `event.$off`
- æ¸…é™¤å®šæ—¶å™¨
- è§£ç»‘è‡ªå®šä¹‰çš„DOMäº‹ä»¶ï¼Œå¦‚ window scroll ç­‰

## ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸæ’æ§½
- çˆ¶ç»„ä»¶æƒ³æ‹¿åˆ°å­ç»„ä»¶çš„æ•°æ®å¦‚dataæ—¶ç”¨åˆ°
- TODO: å®ç°ä¸€ä¸ªè¡¨æ ¼ç»„ä»¶å°±å¯ä»¥çŸ¥é“äº†

## vuexå’Œ action å’Œ mutation æœ‰ä½•åŒºåˆ«
- Getter: å°±åƒè®¡ç®—å±æ€§ä¸€æ ·ï¼Œä¼šæ ¹æ®å®ƒçš„ä¾èµ–è¢«ç¼“å­˜èµ·æ¥ï¼Œ ä¸”åªæœ‰å½“å®ƒçš„ä¾èµ–å€¼å‘ç”Ÿäº†æ”¹å˜æ‰ä¼šè¢«é‡æ–°è®¡ç®—
- Mutationï¼šä¸€èˆ¬åšåŸå­æ“ä½œ, æ˜¯å”¯ä¸€æ›´æ”¹ store ä¸­çŠ¶æ€çš„æ–¹æ³•ï¼Œä¸”å¿…é¡»æ˜¯åŒæ­¥å‡½æ•°
- Actionï¼šç”¨äºæäº¤ mutationï¼Œè€Œä¸æ˜¯ç›´æ¥å˜æ›´çŠ¶æ€ï¼Œå¯ä»¥æ•´ä¸ªå¤šä¸ªmutation, å¯ä»¥åŒ…å«ä»»æ„å¼‚æ­¥æ“ä½œ
- Moduleï¼šå…è®¸å°†å•ä¸€çš„ Store æ‹†åˆ†ä¸ºå¤šä¸ª store ä¸”åŒæ—¶ä¿å­˜åœ¨å•ä¸€çš„çŠ¶æ€æ ‘ä¸­

## vue-routeræ¨¡å¼
- hashæ¨¡å¼
- historyæ¨¡å¼ (æœåŠ¡å™¨æ”¯æŒ)
- [SPA-router å®ç°åŸç†](../vue/%E9%87%8D%E5%AD%A6vue-router%E5%8E%9F%E7%90%86.md)
- [vue-router æºç åˆ†æ](../vue/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-vueRouter.md)

## å°†ä¸­é—´ç»„ä»¶æ‰€æœ‰çš„propsä¼ é€’ç»™å­ç»„ä»¶
- `<child :topProps="$props">`
- $attr


## ç”¨vNodeæè¿°ä¸€ä¸ªdomç»“æ„
<!-- ![5f604da2d0b8a32f36d6ee7242a94f0f.png](evernotecid://A8CC14F8-F351-4473-9E82-5EFAB88A4F7D/appyinxiangcom/18783918/ENResource/p1757) -->
## ç›‘å¬dataå˜åŒ–çš„æ ¸å¿ƒAPI
- `Object.defineProperty`
- æ·±åº¦ç›‘å¬åŸç†,ç›‘å¬æ•°ç»„çš„å®ç°
- æœ‰ä½•ç¼ºç‚¹

## Vueå¦‚ä½•ç›‘å¬æ•°ç»„å˜åŒ–
- `Object.defineProperty`ä¸èƒ½ç›‘å¬æ•°ç»„å˜åŒ–
- é‡æ–°å®šä¹‰åŸå‹,é‡å†™`pushã€popã€splice`ç­‰æ–¹æ³•
- `Proxy`åŸç”Ÿæ”¯æŒç›‘å¬æ•°ç»„å˜åŒ–

## Vueä¸ºä½•æ˜¯å¼‚æ­¥æ¸²æŸ“,$nextTick
- å¼‚æ­¥æ¸²æŸ“(ä»¥åŠåˆå¹¶dataä¿®æ”¹),ç”¨äºæé«˜æ¸²æŸ“æ€§èƒ½
- `$nextTick` ç”¨äºåœ¨DOMæ›´æ–°å®Œä¹‹å,è§¦å‘å›è°ƒ

## ç®€è¿°diffç®—æ³•è¿‡ç¨‹
- `patch(elem,vnode)` å’Œ `patch(vnode,newVnode)`
- `patchVnode` å’Œ `addVnodes` å’Œ `removeVnodes`
- `updateChildren` (å±€éƒ¨æ¯”å¯¹ keyçš„é‡è¦æ€§)

## è™šæ‹Ÿdomæ˜¯ä»€ä¹ˆ? åŸç†? ä¼˜ç¼ºç‚¹?
## vue å’Œ react åœ¨è™šæ‹Ÿdomçš„diffä¸Šï¼Œåšäº†å“ªäº›æ”¹è¿›ä½¿å¾—é€Ÿåº¦å¾ˆå¿«?
> vue å’Œ react é‡Œçš„keyçš„ä½œç”¨æ˜¯ä»€ä¹ˆ? ä¸ºä»€ä¹ˆä¸èƒ½ç”¨Indexï¼Ÿç”¨äº†ä¼šæ€æ ·? å¦‚æœä¸åŠ keyä¼šæ€æ ·?

## vue çš„keep-aliveçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿå¦‚ä½•åˆ·æ–°çš„?

ç»„ä»¶åˆ‡æ¢ï¼Œä¿å­˜ä¸€äº›ç»„ä»¶çš„çŠ¶æ€é˜²æ­¢å¤šæ¬¡æ¸²æŸ“ï¼Œå°±å¯ä»¥ä½¿ç”¨ keep-alive ç»„ä»¶åŒ…è£¹éœ€è¦ä¿å­˜çš„ç»„ä»¶ã€‚

å¯¹äº keep-alive ç»„ä»¶æ¥è¯´ï¼Œå®ƒæ‹¥æœ‰ä¸¤ä¸ªç‹¬æœ‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œåˆ†åˆ«ä¸º activated å’Œ deactivated 

ç”¨ keep-alive åŒ…è£¹çš„ç»„ä»¶åœ¨åˆ‡æ¢æ—¶ä¸ä¼šè¿›è¡Œé”€æ¯ï¼Œè€Œæ˜¯ç¼“å­˜åˆ°å†…å­˜ä¸­å¹¶æ‰§è¡Œ deactivated é’©å­å‡½æ•°ï¼Œå‘½ä¸­ç¼“å­˜æ¸²æŸ“åä¼šæ‰§è¡Œ actived é’©å­å‡½æ•°

- ç¼“å­˜ç»„ä»¶ï¼Œä¸éœ€è¦é‡å¤æ¸²æŸ“æ—¶,å¦‚å¤šä¸ªé™æ€tabé¡µçš„åˆ‡æ¢
- ä¼˜åŒ–æ€§èƒ½

åŸç†ï¼š`Vue.js`å†…éƒ¨å°†`DOM`èŠ‚ç‚¹æŠ½è±¡æˆäº†ä¸€ä¸ªä¸ªçš„`VNode`èŠ‚ç‚¹ï¼Œ`keep-alive`ç»„ä»¶çš„ç¼“å­˜ä¹Ÿæ˜¯åŸºäº`VNode`èŠ‚ç‚¹çš„è€Œä¸æ˜¯ç›´æ¥å­˜å‚¨`DOM`ç»“æ„ã€‚å®ƒå°†æ»¡è¶³æ¡ä»¶`ï¼ˆpruneCacheä¸pruneCacheï¼‰`çš„ç»„ä»¶åœ¨`cache`å¯¹è±¡ä¸­ç¼“å­˜èµ·æ¥ï¼Œåœ¨éœ€è¦é‡æ–°æ¸²æŸ“çš„æ—¶å€™å†å°†`vnode`èŠ‚ç‚¹ä»`cache`å¯¹è±¡ä¸­å–å‡ºå¹¶æ¸²æŸ“ã€‚

[keep-aliveå®ç°åŸç†](https://www.jianshu.com/p/9523bb439950)

[Vue keep-aliveçš„å®ç°åŸç†](https://blog.csdn.net/weixin_38189842/article/details/103999989)

## vue æ˜¯æ€ä¹ˆè§£ætemplateçš„? templateä¼šå˜æˆä»€ä¹ˆ? 
> vueå•æ–‡ä»¶ç»„ä»¶ SFC ç¼–è¯‘åŸç†

## Historyè·¯ç”±é…ç½® nginx

## vueçš„å“åº”å¼å¼€å‘æ¯”å‘½ä»¤å¼æœ‰ä»€ä¹ˆå¥½å¤„