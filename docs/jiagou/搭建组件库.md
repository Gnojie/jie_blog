ä¸åŒäºjsåº“çš„æ‰“åŒ…æ­å»º
ç»„ä»¶åº“è¿˜éœ€è¦æ‰“åŒ…å‡ºcssï¼Œå› æ­¤å•ç‹¬è®²

ç»„ä»¶åº“å¯¹å¤–æ˜¯ç¼–è¯‘å(å¤–éƒ¨åº”ç”¨é…ç½®loaderä¸ç¼–è¯‘)è¿˜æ˜¯ç¼–è¯‘å‰(è·Ÿå¤–éƒ¨åº”ç”¨ä¸€èµ·ç¼–è¯‘)

å¦‚æœæ˜¯ç¼–è¯‘åçš„ç»„ä»¶ï¼Œå¯ä»¥è„±ç¦»æŠ€æœ¯æ ˆå—ï¼Ÿ

æˆ‘ä»¬å…ˆæ¥å¤§æ¦‚çœ‹ä¸€ä¸‹å¸‚é¢ä¸Šç»„ä»¶åº“æ­å»ºçš„æ–¹å¼


## umd-ç»„ä»¶åº“æ‰“åŒ…äº§ç‰©æ˜¯çº¯js
1. æ‰“åŒ…ç»„ä»¶åº“ä¸æŠ½ç¦»cssï¼Œé€šè¿‡jsåŠ¨æ€æ’å…¥cssï¼Œç»„ä»¶åº“äº§ç‰©ä¼šæ˜¯js
ç»„ä»¶åº“å…¥å£æ–‡ä»¶
```js
//  src/index.js
import Hello from "./components/Hello.vue"

// å¤–éƒ¨çš„Vue.use(MyLib)ä¼šæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå®Œæˆç»„ä»¶çš„å…¨å±€æ³¨å†Œã€‚
function install(Vue){
  Vue.component(Hello.name, Hello)
}

// é€šè¿‡`script`æ ‡ç­¾å¼•å…¥çš„æƒ…å†µï¼Œåœ¨ç»„ä»¶å†…éƒ¨å®Œæˆç»„ä»¶æ³¨å†Œã€‚
if(window && window.Vue) {
  Vue.use(install)
}

export default install
```
ğŸ‘† æ‰“åŒ…æˆumdå
æ”¯æŒ
1. webpack å·¥ç¨‹ `import` å¹¶ `vue.use()`
2. htmlç›´æ¥ `<script src="">`

ğŸ‘† è¿™ç§åªæ‰“åŒ…jsçš„å½¢å¼å…¶å®å’Œæ‰“åŒ…æ™®é€šjså·¥å…·åº“ä¸€æ ·ï¼Œä¸è¿‡æ˜¯æ‰“åŒ…é…ç½®éœ€è¦æ”¯æŒcsså’Œvue

webpack.config.js
```js
//webpack.config.js
const path = require('path')
const { VueLoaderPlugin } = require('vue-loader')
module.exports = {
  mode: 'none',
  entry: './src/index.js',
  output: {
    path: path.join(__dirname,"/dist"),
    filename: 'my-ui.js',  
    libraryTarget: 'umd',  //ç”¨åˆ°çš„æ¨¡å—å®šä¹‰è§„èŒƒ
    library: 'myUi',   //åº“çš„åå­—
    libraryExport: 'default'
  },
  module: {
    rules: [
      {
        test: /\.vue$/,
        use:  ['vue-loader']
      },
      {
        test: /\.css$/,
        use:  ['style-loader','css-loader','postcss-loader']
      },
      {
          test: /\.s[ac]ss$/i,
          use:  ['style-loader','css-loader','postcss-loader','sass-loader']
      },
      {
        test: /\.js$/,
        loader: 'babel-loader',
        exclude: /node_modules/,
      }
    ]
  },
  plugins: [
    new VueLoaderPlugin()
  ],
  externals : {
    // åªæœ‰å½“libraryTarget: 'umd'æ—¶ï¼Œæ‰å¯ä»¥é…ç½®å¦‚ä¸Šé‚£æ ·çš„åŒ…å« { root, amd, commonjsï¼Œ... } çš„å¯¹è±¡ï¼Œå…¶å®ƒçš„libraryTargetçš„å€¼ä¸èƒ½è¿™æ ·é…ç½®ã€‚
    vue: {
      root: "Vue",   //é€šè¿‡ script æ ‡ç­¾å¼•å…¥ï¼Œæ­¤æ—¶å…¨å±€å˜é‡ä¸­å¯ä»¥è®¿é—®çš„æ˜¯ Vue
      commonjs: "vue",  //å¯ä»¥å°†vueä½œä¸ºä¸€ä¸ª CommonJS æ¨¡å—è®¿é—®
      commonjs2: "vue",  //å’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œä½†å¯¼å‡ºçš„æ˜¯ module.exports.default
      amd: "vue"   //ç±»ä¼¼äº commonjsï¼Œä½†ä½¿ç”¨ AMD æ¨¡å—ç³»ç»Ÿ
    }
  }

}
```
ç»„ä»¶åº“å’Œå¼•ç”¨æ–¹å…±åŒçš„å¤–éƒ¨èµ„æºåº“ï¼Œç”±å¼•ç”¨æ–¹æä¾›ï¼Œç»„ä»¶åº“ä¸æ‰“åŒ…è¿›å»ï¼Œå¦‚vueã€lodash

æ‰“åŒ…ç»“æœä¼šæ˜¯umdçš„ç»“æ„ï¼Œå‚è€ƒ[ä»0åˆ°1æ„å»ºç¬¦åˆæ ‡å‡†çš„å…¬å…±åº“](./ä»0åˆ°1æ„å»ºç¬¦åˆæ ‡å‡†çš„å…¬å…±åº“.md)
```js
//å®˜æ–¹ç¤ºä¾‹ã€‚ 'MyUi'å°±æ˜¯libraryä¸­å®šä¹‰çš„åº“åç§°ï¼Œ å¯¹åº”æˆ‘ä»¬è‡ªå·±demoä¸­çš„myUiã€‚

(function webpackUniversalModuleDefinition(root, factory) {
  if(typeof exports === 'object' && typeof module === 'object')
  // Commonjs
    module.exports = factory();    
  else if(typeof define === 'function' && define.amd)
  // AMD
    define([], factory);           
  else if(typeof exports === 'object')
  // ESM???
    exports['MyUi'] = factory();  
  else
  // window
    root['MyUi'] = factory();  
})(typeof self !== 'undefined' ? self : this, function() {
  return _entry_return_; // æ­¤æ¨¡å—è¿”å›å€¼ï¼Œæ˜¯å…¥å£ chunk è¿”å›çš„å€¼
});
```


## umd-æ‰‹åŠ¨æŒ‰éœ€åŠ è½½

å¯¼å‡ºæ–‡ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œä¸€ç‚¹éƒ½ä¸ç¬¦åˆes6 æ¨¡å—åŒ–æ–¹å¼ã€‚æŒ‰ç…§ä¸Šé¢é‚£æ ·çš„é…ç½®æ˜¯æ²¡æœ‰åŠæ³•æŒ‰éœ€åŠ è½½çš„ã€‚

æœ‰å¾ˆå¤šåº“ä¸ºäº†æŒ‰éœ€å¼•ç”¨ï¼ŒæŠŠæ‰“åŒ…è„šæœ¬åšæˆå¤šå…¥å£æ‰“åŒ…çš„å½¢å¼ï¼Œå®ç°å•ä¸ªç»„ä»¶ä¸€ä»½jsï¼Œç„¶åé€šè¿‡æ–‡ä»¶è·¯å¾„è¿›è¡Œå¼•ç”¨ï¼š
```js
import 'echarts/lib/chart/pie'
import 'echarts/lib/component/title'
```
è¿™æ ·å†™ä¸èƒ½ä¸€æ¬¡å¼•å…¥å¤šä¸ªç»„ä»¶ï¼Œä¹Ÿä¸å¤Ÿä¼˜é›…ã€‚element-uiå°±ä¸“é—¨å¼€å‘äº†babelæ’ä»¶babel-plugin-componentï¼Œä½¿æˆ‘ä»¬èƒ½åƒä¸‹é¢è¿™æ ·æŒ‰éœ€å¼•å…¥ï¼š
```js
import { Button, Select } from 'element-ui'
Vue.use(Button)
Vue.use(Select)
```
```js
const path = require('path')
const { VueLoaderPlugin } = require('vue-loader')
module.exports = {
  mode: 'none',
  entry: {
   'hello': './src/components/Hello/index.js',
   'test': './src/components/Test/index.js',
   'my-ui': './src/index.js'
  },
   output: {
    path: path.join(__dirname,"/lib"),
    filename: '[name].js',
    libraryTarget: 'umd',
    library: '[name]',
    libraryExport: 'default'
  },
  module: {
    rules: [
      {
        test: /\.vue$/,
        use:  ['vue-loader']
      },
      {
        test: /\.css$/,
        use:  ['style-loader','css-loader','postcss-loader']
      },
      {
          test: /\.s[ac]ss$/i,
          use:  ['style-loader','css-loader','postcss-loader','sass-loader']
      },
      {
        test: /\.js$/,
        loader: 'babel-loader',
        exclude: /node_modules/,
      }
    ]
  },
  plugins: [
    new VueLoaderPlugin()
  ],
  externals : {
    // åªæœ‰å½“libraryTarget: 'umd'æ—¶ï¼Œæ‰å¯ä»¥é…ç½®å¦‚ä¸Šé‚£æ ·çš„åŒ…å« { root, amd, commonjsï¼Œ... } çš„å¯¹è±¡ï¼Œå…¶å®ƒçš„libraryTargetçš„å€¼ä¸èƒ½è¿™æ ·é…ç½®ã€‚
    vue: {
      root: "Vue",   //é€šè¿‡ script æ ‡ç­¾å¼•å…¥ï¼Œæ­¤æ—¶å…¨å±€å˜é‡ä¸­å¯ä»¥è®¿é—®çš„æ˜¯ Vue
      commonjs: "vue",  //å¯ä»¥å°†vueä½œä¸ºä¸€ä¸ª CommonJS æ¨¡å—è®¿é—®
      commonjs2: "vue",  //å’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œä½†å¯¼å‡ºçš„æ˜¯ module.exports.default
      amd: "vue"   //ç±»ä¼¼äº commonjsï¼Œä½†ä½¿ç”¨ AMD æ¨¡å—ç³»ç»Ÿ
    }
  }
}
```
webpackæŠ½ç¦»css
`style-loader` æ›¿æ¢ä¸º `mini-css-extract-plugin`
![webpackæŠ½ç¦»css](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20220828222715.png)

é…ç½®ç¤ºä¾‹å·¥ç¨‹çš„babel
```js
{
  "presets": [["es2015", { "modules": false }]],
  "plugins": [
    [
      "component",
      {
        "libraryName": "my-ui",
        "styleLibrary": {
          "name": "lib-style", // same with styleLibraryName
          "base": false  // if theme package has a base.css
        }
      }
    ]
  ]
}
```

## ESM-ç»„ä»¶åº“æ‰“åŒ…çº¯js

ä½¿ç”¨rollup
[rollupä»å…¥é—¨åˆ°æ‰“åŒ…ä¸€ä¸ªæŒ‰éœ€åŠ è½½çš„ç»„ä»¶åº“](https://segmentfault.com/a/1190000042001908?utm_source=sf-backlinks)

rollup.config.js
```js
import babel from 'rollup-plugin-babel'
import commonjs from 'rollup-plugin-commonjs'
import vue from 'rollup-plugin-vue'
import autoprefixer from 'autoprefixer'
export default {
  input: "./src/index.js",
  // ä¸€ä¸ªå…¥å£æ‰“åŒ…å‡ºå¤šç§äº§ç‰©
  output: [
    // umdäº§ç‰©
    {
      file: './dist/my-lib-umd.js',
      format: 'umd',
      name: 'myLib'
    },
    // esmäº§ç‰©
    {
      file: './dist/my-lib-es.js',
      format: 'es'
    },
    // cjsäº§ç‰©
    {
      file: './dist/my-lib-cjs.js',
      format: 'cjs'
    }
  ],
  plugins:[
    babel({
        exclude: 'node_modules/**'
    }),
    // vueç¼–è¯‘é…ç½®
    vue({
      style: {
        postcssPlugins: [
          autoprefixer()
        ]
      }
    }),
    // TODO: cssæŠ½ç¦»é…ç½®
    // rollupè‡ªèº«ä¸æ”¯æŒcjsè¯­æ³•(è‡ªå·±å†™çš„ä»£ç å°½é‡ä¸ä½¿ç”¨cjsï¼Œå¤–éƒ¨åº“åˆ™æ²¡åŠæ³•)ï¼Œéœ€è¦æ’ä»¶æ”¯æŒ
    commonjs()
  ],
  external:[  //å¤–éƒ¨åº“ï¼Œ ä½¿ç”¨'umd'æ–‡ä»¶æ—¶éœ€è¦å…ˆå¼•å…¥è¿™ä¸ªå¤–éƒ¨åº“
    'vue'
  ]
}
```

package.json
```json
{
  "main": "dist/my-lib-cjs.js",
  "module": "dist/my-lib-es.js",
}
```

## excemple

å†™ç¤ºä¾‹è°ƒè¯•é¡µé¢æ—¶ï¼Œå¯ä»¥é€šè¿‡npm linkæ¥ç›´æ¥å¼•å…¥èµ„æºï¼Œè€Œä¸éœ€è¦å…ˆå†™æˆ`./dist/xx`

é¦–å…ˆåœ¨ç»„ä»¶åº“ `package.json`(é…ç½®å¥½mainæŒ‡å‘æ‰“åŒ…åè·¯å¾„) ç›®å½•ä¸‹åˆå§‹åŒ–link `npm link`

å†å†excemleå·¥ç¨‹ä¸‹ `npm link my-ui` package.jsonä¸­å®šä¹‰çš„"name": "my-lib"

çƒ­æ›´æ–°é—®é¢˜ï¼Œå¼•å…¥çš„éƒ½æ˜¯æ‰“åŒ…åçš„åº“ï¼Œä¿®æ”¹æºç ä¸ä¼šå®æ—¶ç¼–è¯‘ï¼Œå› æ­¤æ²¡æœ‰çƒ­æ›´æ–°æ•ˆæœ


