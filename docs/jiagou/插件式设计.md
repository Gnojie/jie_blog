## æ’ä»¶åŒ–æ¦‚å¿µ

> ğŸ¤” æ’ä»¶åŒ–/ç»„ä»¶åŒ–(æ¥¼å±‚å¼‚æ­¥ç»„ä»¶)/å‡½æ•°å¼ç¼–ç¨‹(ç»„åˆ)ï¼Ÿ

- å‰ç«¯æ‰“åŒ…å·¥å…·çš„æ’ä»¶åŒ– ğŸ”Œ
  - webpackçš„å„ç§cssã€vueçš„ plugin
  - babelçš„å„ç§éœ€å°é²œç‰ˆæ–°ESè¯­æ³•ç¼–è¯‘æ’ä»¶
  - rollup
  - vite
- å‰ç«¯æ¡†æ¶çš„æ’ä»¶åŒ– ğŸ”Œ
  - Vuejsæ¸è¿›å¼çš„routerã€vuexç­‰
  - React
  - UmiJSã€Eggjsã€DvaJSç­‰
- ä»£ç ç¼–è¾‘å™¨
  - VSCodeçš„å„ç§æ’ä»¶: prettierã€ä¸»é¢˜çš®è‚¤ç­‰
- æµè§ˆå™¨ ğŸ”Œ
  - è°·æ­Œæµè§ˆå™¨çš„æ’ä»¶å¸‚åœº
  - urlè·å–åˆ°çš„ç½‘é¡µå¯ä»¥è§†ä¸ºæ’ä»¶ï¼Œæµè§ˆå™¨çª—å£åˆ™æ˜¯ä¸»ä½“ç¨‹åº

ä¼˜ç‚¹ï¼š
- å‡å°‘ä¸»ä½“çš„å¤æ‚åº¦ï¼Œç²¾ç®€æ ¸å¿ƒ
  - webpack ã€babel å¤§éƒ¨åˆ†ä»£ç éƒ½æ˜¯æ’ä»¶ï¼Œä¸»ä½“ä¸»è¦æ˜¯è½¯ä»¶ç”Ÿå‘½å‘¨æœŸè°ƒé…ï¼ŒçŠ¶æ€æµè½¬ç­‰ï¼Œä»¥åŠå°‘é‡æ ¸å¿ƒèƒ½åŠ›çš„å®ç°
- æ¸è¿›å¼ï¼ŒæŒ‰éœ€ä½¿ç”¨
  - Vuejsï¼Œæ’ä»¶æ›´å¤šæ˜¯å¯¹å…¶èƒ½åŠ›ä¸Šçš„ä¸€ä¸ªè¡¥å……
- ç‹¬ç«‹äºä¸»ä½“ï¼Œæ–°å¢åŠŸèƒ½ä¸éœ€è¦å‘å¸ƒå‡çº§
- å¯æ‰©å±•æ€§ï¼Œå€ŸåŠ©ç¤¾åŒºæå‡ç”Ÿå‘½åŠ›


è®¾è®¡æ€è·¯ï¼š
- å“ªäº›æ˜¯æ˜“å˜çš„ï¼Œå“ªäº›æ˜¯ç›¸å¯¹ç¨³å®šçš„
  - æ˜“å˜çš„éƒ¨åˆ†åº”æš´éœ²å‡ºç›¸åº”çš„èƒ½åŠ›ç”±æ’ä»¶æ¥å®Œæˆ
- æ’ä»¶å¦‚ä½•å½±å“ä¸»ä½“ç¨‹åº
  - é€šå¸¸ä¼šä»¥æ‰©å±•è¡Œä¸ºï¼Œä¿®æ”¹çŠ¶æ€ï¼Œå˜æ›´å±•ç¤ºçš„æ–¹å¼ä½“ç°

å…ˆæ•´ç†å·²çŸ¥å¾…è§£å†³çš„é—®é¢˜
å°†è¿™äº›é—®é¢˜ä½œä¸ºæ ·æœ¬å°è¯•åˆ†ç±»å’Œæå–å…±æ€§
ä»è€Œå½¢æˆä¸€å¥—æŠ½è±¡æ¨¡å¼

## è®¾è®¡ä¸€ä¸ªæ’ä»¶åŒ–è®¡ç®—å™¨

### æ™®é€šè®¡ç®—å™¨

```js
// è®¡ç®—å™¨
class Calculator {
  construct(initVal) {
    this.num = initVal;
  }
  // åŠ æ³•
  add(num) {
    this.num = this.num + num;
    return this;
  }
  // å‡æ³•
  subtract(num) {
    this.num = this.num - num;
    return this;
  }
  // ç»“æœ
  result() {
    return this.num;
  }
}

const myCalculator = new Calculator(5);
myCalculator.add(5).subtract(2).result(); // 8
```
ğŸ‘† åªæœ‰åŠ å‡æ³•

### æ’ä»¶è®¡ç®—å™¨-æ’ä»¶å®šä¹‰

æŒ‰ç…§è®¾è®¡æ€è·¯ï¼š
- ä¸»ä½“æ˜¯è¿ç®—ï¼šå½“å‰å€¼å’Œä¸€ä¸ªæ–°å€¼çš„è¿ç®—è¿‡ç¨‹ï¼Œè¿™éƒ¨åˆ†æ˜¯ç¨³å®šçš„
- æ”¯æŒçš„è¿ç®—é€»è¾‘(åŠ /å‡æ³•ğŸ”§å·¥å…·å‡½æ•°)æ˜¯å¯æ‰©å±•çš„ï¼Œé€‚åˆåšæˆæ’ä»¶

ğŸ‘‡ è¿ç®—æ’ä»¶æä¾›è®¡ç®—é€»è¾‘ä½œä¸ºå›è°ƒå‡½æ•°
```ts
// æ’ä»¶ç±»å‹å£°æ˜
interface Plugin {
  name: string;
  calculate(num: number) => this;
}

// åŠ æ³•æ’ä»¶
class AddPlugin implements Plugin {
  name: 'add',
  calculate(num) {
    this.num = this.num + num;
    return this;
  }
}

// å‡æ³•æ’ä»¶
class SubtractPlugin implements Plugin {
  name: 'subtract',
  calculate(num) {
    this.num = this.num - num;
    return this;
  }
}
```
ğŸ‘† name ç”¨äºè°ƒç”¨æ–¹æŒ‡å®šä½¿ç”¨å“ªä¸ªæ’ä»¶è®¡ç®—é€»è¾‘ï¼Œä¸»ä½“ç¨‹åºè°ƒç”¨ç›¸åº”æ’ä»¶æä¾›çš„å›è°ƒ

### æ’ä»¶è®¡ç®—å™¨-ä¸»ä½“ç¨‹åº

- ä¸»ä½“ç¨‹åºè°ƒç”¨ç›¸åº”çš„å›è°ƒå‡½æ•°å­˜å‚¨ç»“æœï¼Œç”¨äºä¸‹ä¸€æ¬¡è®¡ç®—

```js
// ç¨‹åºä¸»ä½“ï¼Œå®šä¹‰ç¨‹åºæ ¸å¿ƒé€»è¾‘æ˜¯å¢åŠ è®¡ç®—å™¨è¿ç®—èƒ½åŠ›
class Calculator {
  plugins = [];
  construct(initVal) {
    this.num = initVal;
  }

  // å®‰è£…æ’ä»¶
  use(plugin) {
    this.plugins.push(plugin);
    this[plugin.name] = plugin.calculate.bind(this);
  }

  // ç»“æœ
  result() {
    return this.num;
  }

  // è¾“å‡ºæ’ä»¶ä¿¡æ¯ï¼Œæ ¹æ®æ’ä»¶ä¿¡æ¯äº†è§£æ”¯æŒä»€ä¹ˆè¿ç®—
  help() {
    return `support ${this.plugins.map(plugin => plugin.name).join(',')}`;
  }
}
```

### æ’ä»¶è®¡ç®—å™¨-ä½¿ç”¨

```js
// åˆå§‹åŒ–è®¡ç®—å™¨
const myCalculator = new Calculator(5);
// å®‰è£…æ’ä»¶
myCalculator.use(new AddPlugin());
myCalculator.use(new SubtractPlugin());
 
myCalculator.add(5).subtract(2).result(); // 8
```

## æ’ä»¶åŒ–ç³»ç»Ÿ

### æ’ä»¶åŒ–ç³»ç»Ÿç»„æˆ

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214111326.png)

- Program: ä¸»ä½“ç¨‹åºï¼Œæœ‰ç€ä¸€å®šé¡ºåºçš„ç”Ÿå‘½å‘¨æœŸ Hooksï¼Œå¯ä»¥åœ¨ä¸åŒæ—¶æœŸè°ƒç”¨æ’ä»¶
- Plugin Loader: æ’ä»¶ç®¡ç†é€»è¾‘ï¼Œå¯¹åº”ğŸ‘†æ’ä»¶åŒ–è®¡ç®—å™¨çš„ useï¼Œæœ€åŸºç¡€çš„æ˜¯å®‰è£…ã€è°ƒç”¨é€»è¾‘ï¼Œå¯ä»¥æœ‰å¤æ‚çš„ç®¡ç†é€»è¾‘ï¼Œå¦‚å¸è½½æ’ä»¶ç­‰
- Plugins: æ’ä»¶åˆ—è¡¨
- Plugin Impl: æ’ä»¶å®ç°(Plugin Implementation)ï¼Œå°±æ˜¯æ’ä»¶å†…å®¹
- Plugin Interface: æ’ä»¶æ¥å£å£°æ˜ï¼Œå¯¹åº”ğŸ‘†æ’ä»¶åŒ–è®¡ç®—å™¨çš„ç±»å‹å£°æ˜ï¼Œç”¨äºç»™å¼€å‘è€…äº†è§£ä¸€ä¸ªæ’ä»¶çš„åŸºæœ¬å±æ€§
  - ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸»ä½“ç¨‹åºï¼Œæ³¨å…¥ç»™æ’ä»¶çš„å„ç§æ•°æ®çŠ¶æ€ï¼Œæˆ–ç‰¹æ®Šå›è°ƒ

### æ’ä»¶æ³¨å…¥(æŒ‚è½½)ã€é…ç½®ã€åˆå§‹åŒ–

> å¦‚ä½•è®©ä¸»ä½“ç¨‹åºæ„ŸçŸ¥åˆ°æ’ä»¶çš„å­˜åœ¨

ğŸ‘‡ æ’ä»¶æ³¨å…¥(ä¸»ç¨‹åºæŒ‚è½½/åŒ¹é…æ’ä»¶)
æ³¨å…¥çš„æ–¹å¼ä¸€èˆ¬å¯ä»¥åˆ†ä¸º
- å£°æ˜å¼(babel)
  - é€šè¿‡é…ç½®ä¿¡æ¯ï¼Œå‘Šè¯‰ä¸»ä½“ç¨‹åºåº”è¯¥å»å“ªé‡Œå»å–ä»€ä¹ˆæ’ä»¶
  - ä¸»ä½“ç¨‹åºè¿è¡Œæ—¶ä¼šæŒ‰ç…§çº¦å®šä¸é…ç½®å»åŠ è½½å¯¹åº”çš„æ’ä»¶
  - å¦‚ Babelï¼Œé€šè¿‡åœ¨babelé…ç½®æ–‡ä»¶ä¸­å¡«å†™æ’ä»¶åç§°ï¼Œè¿è¡Œæ—¶å» modules ç›®å½•ä¸‹å»æŸ¥æ‰¾å¯¹åº”çš„æ’ä»¶å¹¶åŠ è½½(!==ä¸‹è½½)ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…åˆ™ä¼šæŠ¥é”™
  - é€‚åˆè‡ªå·±å•ç‹¬å¯åŠ¨ä¸ç”¨æ¥å…¥å¦ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„åœºæ™¯ï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬ä½¿ç”¨ç¼–ç¨‹å¼è¿›è¡Œå®šåˆ¶çš„è¯æˆæœ¬ä¼šæ¯”è¾ƒé«˜ï¼Œä½†æ˜¯ç›¸å¯¹çš„ï¼Œå¯¹äºæ’ä»¶å‘½åå’Œå‘å¸ƒæ¸ é“éƒ½ä¼šæœ‰ä¸€äº›é™åˆ¶
- ç¼–ç¨‹å¼(webpackã€vue)
  - ä¸»ä½“ç¨‹åºæä¾›æŸç§æ³¨å†Œ APIï¼Œå¼€å‘è€…é€šè¿‡å°†æ’ä»¶ä¼ å…¥ API ä¸­æ¥å®Œæˆæ³¨å†Œ
  - é€‚åˆäºéœ€è¦åœ¨å¼€å‘ä¸­è¢«å¼•å…¥ä¸€ä¸ªå¤–éƒ¨ç³»ç»Ÿçš„æƒ…å†µ

ğŸ‘‡ æ’ä»¶é…ç½®
é…ç½®çš„ä¸»è¦ç›®çš„æ˜¯å®ç°æ’ä»¶çš„å¯å®šåˆ¶
å› ä¸ºä¸€ä¸ªæ’ä»¶åœ¨ä¸åŒä½¿ç”¨åœºæ™¯ä¸‹ï¼Œå¯èƒ½å¯¹äºå…¶è¡Œä¸ºéœ€è¦åšä¸€äº›å¾®è°ƒï¼Œè¿™æ—¶å€™å¦‚æœæ¯ä¸ªåœºæ™¯éƒ½å»åšä¸€ä¸ªå•ç‹¬çš„æ’ä»¶é‚£å°±æœ‰ç‚¹å°é¢˜å¤§ä½œäº†
é…ç½®å¦‚ä½•ç”Ÿæ•ˆå°±å’ŒğŸ‘‡æ’ä»¶åˆå§‹åŒ–çš„æœ‰ç‚¹å…³è”

ğŸ‘‡ æ’ä»¶åˆå§‹åŒ–
æ’ä»¶é…ç½®ä¸€èˆ¬åœ¨æ³¨å…¥æ—¶ä¸€èµ·ä¼ å…¥ï¼Œå¾ˆå°‘ä¼šæ”¯æŒæ³¨å…¥åå†è¿›è¡Œé‡æ–°é…ç½®

- åˆå§‹åŒ–æ’ä»¶æ–¹å¼
  - å·¥å‚æ¨¡å¼
    - ä¸€ä¸ªæ’ä»¶æš´éœ²å‡ºæ¥çš„æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œç”±è°ƒç”¨è€…ä¼ å…¥æ’ä»¶é…ç½®ä¿¡æ¯ç”Ÿæˆæ’ä»¶å®ä¾‹æˆ–è€…ä¸»ä½“ç¨‹åºæ¥ä¼ å…¥æ’ä»¶é…ç½®ä¿¡æ¯ï¼Œç”Ÿæˆæ’ä»¶å®ä¾‹
    - babel æ˜¯ç”±ä¸»ä½“ç¨‹åºæ ¹æ®é…ç½®ä¿¡æ¯å®ä¾‹åŒ–æ’ä»¶å¯¹è±¡
  - è¿è¡Œæ—¶ä¼ å…¥
    - ä¸»ä½“ç¨‹åºåœ¨è°ƒåº¦æ’ä»¶æ—¶ä¼šé€šè¿‡çº¦å®šçš„ä¸Šä¸‹æ–‡æŠŠæ’ä»¶é…ç½®ä¿¡æ¯ç»™åˆ°æ’ä»¶
- åˆå§‹åŒ–æ’ä»¶æ—¶æœº
  - æ³¨å…¥æ’ä»¶æ—¶åˆå§‹åŒ–
  - ç»Ÿä¸€åˆå§‹åŒ–
  - è¿è¡Œæ—¶åˆå§‹åŒ–

---

ğŸ’¡ ç±»ä¼¼å‡½æ•°ç»„åˆï¼Œæœ‰æ—¶å€™æŸäº›æ’ä»¶ç»„åˆæ˜¯æ†ç»‘çš„

ä¾èµ–è®¸å¤šæ’ä»¶ç»„åˆæ¥å®Œæˆä¸€ä»¶å¤æ‚çš„äº‹æƒ…
å¯ä»¥æä¾›ä¸€ç§ Preset çš„æ¦‚å¿µï¼Œå»æ‰“åŒ…å¤šä¸ªæ’ä»¶åŠå…¶é…ç½®
ä½¿ç”¨è€…åªéœ€è¦å¼•å…¥ Preset å³å¯ï¼Œä¸ç”¨å…³å¿ƒé‡Œé¢æœ‰å“ªäº›æ’ä»¶

å¦‚ Babel è½¬è¯‘ react è¯­æ³•æ—¶ï¼Œå…¶å®è¦å¼•å…¥
- `syntax-jsx`
- `transform-react-jsx`
- `transform-react-display-name`
- `transform-react-pure-annotationsd`
- ç­‰å¤šä¸ªæ’ä»¶

æœ€ç»ˆç»™åˆ°çš„æ˜¯ `preset-react`è¿™æ ·ä¸€ä¸ªåŒ…

---

### æ’ä»¶å¦‚ä½•å½±å“ä¸»ä½“ç¨‹åº(é€šä¿¡)(plugin interface)

æ’ä»¶å½±å“ğŸ‘‡ä¸»ä½“ç¨‹åº
- è¡Œä¸ºé€»è¾‘
- äº¤äº’
- å±•ç¤ºUI

ä¸»ä½“ç¨‹åºè¦æä¾›æ’ä»¶éœ€è¦ç”¨åˆ°çš„ç›¸å…³å›è°ƒæˆ–æ˜¯API
ğŸ‘‡ [VSCode](#vscode) æ’ä»¶å¤§è‡´è¦†ç›–äº†è¿™äº›ä¸ä¸»ä½“ç¨‹åºçš„é€šä¿¡

### ä¸»ä½“ç¨‹åºçš„æ’ä»¶è°ƒåº¦æœºåˆ¶

ğŸ‘‡ ä¸»ä½“ç¨‹åºç›´æ¥è°ƒç”¨æ’ä»¶
ä¸»ä½“ç¨‹åºéœ€è¦å¤„ç†å¥½æ’ä»¶è°ƒåº¦ï¼Œè¿™æ®µé€»è¾‘å¯èƒ½å¢åŠ å¤æ‚åº¦
- VSCode ç›´æ¥è°ƒç”¨æ’ä»¶çš„ activate å’Œ deactivate 

ğŸ‘‡ ä¸»ä½“ç¨‹åºé€šè¿‡ä¸­è½¬çš„ç»Ÿä¸€è°ƒåº¦æœºåˆ¶(webpackçš„Hooks)ï¼Œè§¦å‘ç›¸åº”æ’ä»¶
é’©å­æœºåˆ¶é€‚åˆæ³¨å…¥ç‚¹å¤š
æ¾è€¦åˆéœ€æ±‚é«˜çš„æ’ä»¶åœºæ™¯
èƒ½å¤Ÿå‡å°‘æ•´ä¸ªä¸»ä½“ç¨‹åºä¸­æ’ä»¶è°ƒåº¦çš„å¤æ‚åº¦
- webpack

ğŸ‘‡ ä½¿ç”¨è€…è¿è¡Œæ—¶è°ƒç”¨æ’ä»¶
æœ¬è´¨å°±æ˜¯å°†æ’ä»¶æä¾›çš„èƒ½åŠ›ï¼Œç»Ÿä¸€ä½œä¸ºç³»ç»Ÿçš„é¢å¤–èƒ½åŠ›å¯¹å¤–é€å‡ºï¼Œæœ€ååˆç³»ç»Ÿçš„å¼€å‘ä½¿ç”¨è€…å†³å®šä»€ä¹ˆæ—¶å€™è°ƒç”¨
- JQuery çš„æ’ä»¶ä¼šæ³¨å†Œ fn ä¸­çš„é¢å¤–è¡Œä¸º
- Egg çš„æ’ä»¶å¯ä»¥å‘ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œé¢å¤–çš„æ¥å£èƒ½åŠ›

è¿™ç§æ¨¡å¼æ¯”è¾ƒé€‚åˆåˆéœ€è¦å®šåˆ¶æ›´å¤šå¯¹å¤–èƒ½åŠ›ï¼Œåˆéœ€è¦å¯¹èƒ½åŠ›çš„å‡ºå£åšæ”¶å£çš„åœºæ™¯
å¦‚æœå¸Œæœ›ç”¨æˆ·é€šè¿‡ç»Ÿä¸€çš„æ¨¡å¼è°ƒç”¨ä½ çš„èƒ½åŠ›ï¼Œé‚£å¤§å¯å°è¯•ä¸€ä¸‹(ğŸ¤” è®¾è®¡æ¨¡å¼-ä»£ç†ï¼Ÿ)
å¯ä»¥å°è¯•ä½¿ç”¨æ–°çš„ `Proxy` ç‰¹æ€§æ¥å®ç°è¿™ç§æ¨¡å¼

### æ’ä»¶æ¥å£(plugin interface)(APIç­¾å)

ä¸»ä½“ç¨‹åºæä¾›ç»™æ’ä»¶çš„
- çº¯å·¥å…·ğŸ”§æ–¹æ³•ï¼šä¸å½±å“ä¸»ä½“ç¨‹åºçŠ¶æ€
- è·å–å½“å‰ç³»ç»ŸçŠ¶æ€
- ä¿®æ”¹å½“å‰ç³»ç»ŸçŠ¶æ€
- API å½¢å¼æ³¨å…¥åŠŸèƒ½ï¼šä¾‹å¦‚æ³¨å†Œ UIï¼Œæ³¨å†Œäº‹ä»¶ç­‰

ä¸ºäº†å‡å°‘æ’ä»¶ç ´åç³»ç»Ÿçš„å¯èƒ½æ€§
ä¸€èˆ¬å»ºè®®æä¾›å°½å¯èƒ½å°‘çš„ä¸»ä½“ç¨‹åºèƒ½åŠ›ç»™æ’ä»¶
ä¹Ÿå¯ä»¥è€ƒè™‘ç»™æ’ä»¶åˆ›é€ æ²™ç®±ç¯å¢ƒ

### ä¸»ä½“ç¨‹åºçš„æŸä¸ªæ—¶æœºå…è®¸æŒ‚è½½å¤šä¸ªæ’ä»¶

ğŸ‘‡ è¦†ç›–å¼
åªæ‰§è¡Œæœ€æ–°æ³¨å†Œçš„æ’ä»¶é€»è¾‘ï¼Œè·³è¿‡åŸå§‹é€»è¾‘
![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214171803.png)

ğŸ‘‡ ç®¡é“å¼
è¾“å…¥è¾“å‡ºç›¸äº’è¡”æ¥ï¼Œä¸€èˆ¬è¾“å…¥è¾“å‡ºæ˜¯åŒä¸€ä¸ªæ•°æ®ç±»å‹ã€‚
![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214171825.png)

ğŸ‘‡æ´‹è‘±åœˆå¼
åœ¨ç®¡é“å¼çš„åŸºç¡€ä¸Šï¼Œå¦‚æœç³»ç»Ÿæ ¸å¿ƒé€»è¾‘å¤„äºä¸­é—´ï¼Œæ’ä»¶åŒæ—¶å…³æ³¨è¿›ä¸å‡ºçš„é€»è¾‘ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ´‹è‘±åœˆæ¨¡å‹ã€‚
![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214171835.png)
ğŸ‘† å‚è€ƒ [koaçš„ä¸­é—´ä»¶è°ƒåº¦ä¸­å¿ƒ](https://github.com/koajs/compose)

ğŸ‘‡é›†æ•£å¼
é›†æ•£å¼å°±æ˜¯æ¯ä¸€ä¸ªæ’ä»¶éƒ½ä¼šæ‰§è¡Œï¼Œå¦‚æœæœ‰è¾“å‡ºåˆ™æœ€ç»ˆå°†ç»“æœè¿›è¡Œåˆå¹¶ã€‚è¿™é‡Œçš„å‰ææ˜¯å­˜åœ¨æ–¹æ¡ˆï¼Œå¯ä»¥å¯¹æ‰§è¡Œç»“æœè¿›è¡Œ mergeã€‚
![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214172014.png)

ğŸ‘† éƒ½æ˜¯æŒ‰ç…§ç†æƒ³çš„æ’ä»¶å›è°ƒå‡½æ•°æ˜¯åŒæ­¥é€»è¾‘æ¥è°ƒåº¦çš„
å¦‚æœéœ€è¦å¼‚æ­¥, å¯ä»¥ä½¿ç”¨[neo-async](https://www.npmjs.com/package/neo-async), è€Œwebpack çš„ tapble å·²ç»æœ‰ç›¸åº”çš„å¼‚æ­¥å¤„ç†äº†

## VSCode

Clock in status bar è¿™ä¸ª
![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214163911.png)

å‡è®¾å·²ç»å®‰è£…äº†æ’ä»¶ï¼Œé‚£æ’ä»¶å·²ç»å­˜åœ¨äºä¸»ä½“ç¨‹åºçš„æŸä¸ªç›®å½•ä¸‹

package.json å°±æ˜¯æ’ä»¶é…ç½®ä¿¡æ¯
```json
"main": "./extension", // å…¥å£æ–‡ä»¶åœ°å€
"contributes": {
  "commands": [{
    "command": "clock.insertDateTime",
    "title": "Clock: Insert date and time"
  }],
  "configuration": {
    "type": "object",
    "title": "Clock configuration",
    "properties": {
      "clock.dateFormat": {
        "type": "string",
        "default": "hh:MM TT",
        "description": "Clock: Date format according to https://github.com/felixge/node-dateformat"
      }
    }
  }
}
```

ğŸ‘‡ æ’ä»¶å†…å®¹
```js
'use strict';

// The module 'vscode' contains the VS Code extensibility API
// Import the module and reference it with the alias vscode in your code below
const
  clockService = require('./clockservice'),
  ClockStatusBarItem = require('./clockstatusbaritem'),
  vscode = require('vscode');

// this method is called when your extension is activated
// your extension is activated the very first time the command is executed
function activate(context) {
  // Use the console to output diagnostic information (console.log) and errors (console.error)
  // This line of code will only be executed once when your extension is activated

  // The command has been defined in the package.json file
  // Now provide the implementation of the command with  registerCommand
  // The commandId parameter must match the command field in package.json
  context.subscriptions.push(new ClockStatusBarItem());

  context.subscriptions.push(vscode.commands.registerTextEditorCommand('clock.insertDateTime', (textEditor, edit) => {
    textEditor.selections.forEach(selection => {
      const
        start = selection.start,
        end = selection.end;

      if (start.line === end.line && start.character === end.character) {
        edit.insert(start, clockService());
      } else {
        edit.replace(selection, clockService());
      }
    });
  }));
}

exports.activate = activate;

// this method is called when your extension is deactivated
function deactivate() {
}

exports.deactivate = deactivate;
```
ğŸ‘† å…³æ³¨æŠ›å‡ºï¼Œæ‰æ˜¯ä¸»ä½“ç¨‹åºæ³¨å…¥çš„ä¸œè¥¿

ä¹Ÿå°±æ˜¯ `VSCode` é™åˆ¶äº†æ’ä»¶éœ€è¦æŠ›å‡º2ä¸ªå‡½æ•° `activate` `deactivate` 

- æ’ä»¶æ³¨å…¥: ä»ä¸»ä½“ç¨‹åºä¸Šçœ‹ï¼Œä»æ’ä»¶å•†åº—å®‰è£…çš„æ’ä»¶ï¼Œæ³¨å…¥æ–¹å¼å±äºå£°æ˜å¼
- æ’ä»¶é…ç½®: `package.json` æ–‡ä»¶ `contributes` `configuration`
- æ’ä»¶æ¥å£: é™åˆ¶æ’ä»¶å†…å®¹ç»“æ„è¦æŠ›å‡º`activate` `deactivate`ï¼Œä»¥åŠä¸»ä½“ç¨‹åºç¯å¢ƒå…¨å±€æä¾›çš„api

## webpack

webpack æ ¸å¿ƒæ¨¡å—(ä¸»ä½“ç¨‹åº)ä¸ºcompiler å’Œ compilationï¼Œä»–ä»¬éƒ½æœ‰å„è‡ªçš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆHookï¼‰

webpack æ ¸å¿ƒ(ä¸»ä½“ç¨‹åº)å®šä¹‰ç”Ÿå‘½å‘¨æœŸï¼ˆæˆ–è€…å«äº‹ä»¶æµï¼‰
æ’ä»¶ç®¡ç†é€»è¾‘(Plugin Loader)ï¼Œå°±æ˜¯åœ¨å„ä¸ªç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨æ’ä»¶åœ¨å¯¹åº”ç”Ÿå‘½å‘¨æœŸæ³¨å†Œçš„æ–¹æ³•

ğŸ‘† ç›¸å¯¹äºæ’ä»¶åŒ–è®¡ç®—å™¨ï¼Œä¸€ä¸ªæ’ä»¶é™¤äº†å®šä¸€ä¸ªæ’ä»¶åã€å›è°ƒå‡½æ•°å¤–
è¿˜éœ€è¦æŠŠå›è°ƒå‡½æ•°æŒ‡å®šä¸ºä¸ç—›çš„webpack Hooksè°ƒç”¨

å› ä¸ºè¿™æ ·ä¸»ä½“ç¨‹åºä¸­å°±æ¶‰åŠç”Ÿå‘½å‘¨æœŸä¸­æ’å…¥é€»è¾‘
é‚£ä¹ˆè¿™æ®µé€»è¾‘æ˜¯
- åŒæ­¥æ‰§è¡Œ/å¼‚æ­¥æ‰§è¡Œ
- å¹¶è¡Œæ‰§è¡Œ/ä¸²è¡Œæ‰§è¡Œ
- æ‰§è¡Œç»“æœéœ€ä¸éœ€è¦å½±å“ä¹‹åçš„ç”Ÿå‘½å‘¨æœŸ

å› æ­¤ä¸»ä½“ç¨‹åºä¸ºäº†é€‚åº”æ’ä»¶ï¼Œéœ€è¦æœ‰å®Œå–„çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å¤„ç†æœºåˆ¶
`webpack` å°è£…äº†ä¸€ä¸ª `Hook` çš„æ ¸å¿ƒåº“ `Tapable` ï¼Œ `compiler` å’Œ `compilation` éƒ½æ˜¯åŸºäº `Tapable` çš„å®ç°

ğŸ‘‡ ä¹Ÿå°±æ˜¯webpackçš„ç”Ÿå‘½å‘¨æœŸHooksæœ‰ä¸€å®šçš„å¤æ‚é€»è¾‘åœ¨
![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214112944.png)

TODO: å…³äº `Tapable` æˆ‘ä»¬åœ¨ [é‡å­¦webpack](../webpack/é‡å­¦webpack-04plugin.md) é‡Œè¯¦ç»†è®²è§£

è¿™é‡Œæœ‰ä¸€ä¸ªæ¨¡ç³Šçš„æ¦‚å¿µå³å¯ï¼šwebpack çš„Hooksäº‹ä»¶å¤„ç†æœºåˆ¶å°±æ˜¯ä¸€ä¸ª EventEmitter(å‘å¸ƒè®¢é˜…æ¨¡å¼ç­‰) 

## TODO: rollup

rollupæ€ä¹ˆå¤„ç†æ’ä»¶ [PluginDriver](https://github.com/rollup/rollup/blob/master/src/utils/PluginDriver.ts)


## jQuery

```js
(function ($) {
  $.fn.myPlugin = function () { ... }
})(jQuery)
```

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214123631.png)

ğŸ‘‡ ç¤ºä¾‹

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214123927.png)

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214123939.png)

- pluginCoreï¼šä¸»ä½“ç¨‹åºé€šè¿‡åŸå‹é“¾æ¥æŒ‚è½½ä¸åŒçš„æ’ä»¶
  - æ‰‹åŠ¨è·å¾—jQueryå®ä¾‹(ä¸»ä½“å¯¹è±¡)åè°ƒç”¨æ’ä»¶ï¼Œè€Œä¸æ˜¯ä¸»ä½“ç¨‹åºæœ‰ç”Ÿå‘½å‘¨æœŸHookè‡ªåŠ¨è°ƒç”¨æ’ä»¶
  - ğŸ˜– æ›´åƒæ˜¯æ–°å¢äº†ğŸ”§å·¥å…·æ–¹æ³•ï¼Œè€Œæ”¾ç½®çš„åœ°æ–¹ä¸æ˜¯å…¨å±€å˜é‡ï¼Œä¹Ÿä¸æƒ³è‡ªå·±å¼•å…¥ï¼Œäºæ˜¯æ”¾åˆ°è¿™ä¸ªä¸»ä½“ä¸Š
- pluginï¼šæ— é™åˆ¶ï¼Œå¯ä»¥æ˜¯JavaScriptçš„ç±»å‹ï¼Œä¸€èˆ¬æ˜¯å®ç°å…·ä½“åŠŸèƒ½çš„æ¨¡å—ï¼Œæ¯”å¦‚ï¼Œæ—¥æœŸé€‰æ‹©å™¨ç­‰ã€‚

## babel

TODO: [æ·±å…¥babel](./æ·±å…¥babel.md)

babelè®¾è®¡æ€è·¯
å°†ä¸€ç§è¯­è¨€çš„ä»£ç è½¬åŒ–ä¸ºå¦ä¸€ç§è¯­è¨€çš„ä»£ç 
é‡åˆ°é—®é¢˜
- æ— æ³•åœ¨è®¾è®¡æ—¶å°±ç©·ä¸¾è¯­æ³•ç±»å‹
- ä¹Ÿä¸ç¡®å®šå®Œç¾è½¬æ¢ä¸€ç§æ–°çš„è¯­æ³•

è½¬è¯‘çš„ä¸‰ä¸ªæ­¥éª¤
- `parse` - åˆ†è¯ã€è¯ä¹‰è¯­æ³•
- `transform` - æŸäº›è¯­æ³•æ ‘ç»“æ„è½¬æ¢æˆç›¸åº”çš„å·²çŸ¥çš„è¯­æ³•æ ‘ç»“æ„
- `generate`

ä¸»è¦é¢å‘ `parse` å’Œ `transform` æä¾›æ’ä»¶æ–¹å¼åšæ‰©å±•æ€§æ”¯æŒ


![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214144643.png)

é€šè¿‡ä¸€äº›ä¸ç¡®å®šä½†å¯èƒ½æœªæ¥å¾…è§£å†³çš„é—®é¢˜æ¥æµ‹è¯•
æ˜¯å¦å­˜åœ¨æ— æ³•å¥—ç”¨çš„æƒ…å†µ

ğŸ‘‡ babelæ’ä»¶ç»“æ„
```js
function () {
  return {
    name: 'æ’ä»¶å',
    visitor: {
      enter(nodePath) {},
      exit(nodePath) {},
      [NodeType](nodePath) {},
      // NodeTypeæŒ‡çš„æ˜¯babelè½¬è¯‘ASTå¾—åˆ°çš„èŠ‚ç‚¹ç±»å‹ï¼Œåˆ©ç”¨è¿™ä¸ªèŠ‚ç‚¹ç±»å‹ä½œä¸ºå›è°ƒå‡½æ•°çš„key
    }
  }
}
```
å¯ä»¥çœ‹å‡ºå’Œ ğŸ‘†æ’ä»¶åŒ–è®¡ç®—å™¨éå¸¸åƒï¼Œåªæ˜¯å›è°ƒå‡½æ•°æ”¹ä¸ºäº†ä¸€ä¸ªå¯¹è±¡å­˜å‚¨é™åˆ¶å˜é‡åçš„å‡½æ•°å±æ€§

ğŸ‘‡ ç®­å¤´å‡½æ•°è½¬è¯‘æ’ä»¶ [babel-plugin-transform-arrow-functions](https://github.com/babel/babel/blob/main/packages/babel-plugin-transform-arrow-functions/src/index.ts)

```ts
import { declare } from "@babel/helper-plugin-utils";

export interface Options {
  spec?: boolean;
}

export default declare((api, options: Options) => {
  api.assertVersion(7);

  const noNewArrows = api.assumption("noNewArrows") ?? !options.spec;

  return {
    name: "transform-arrow-functions",

    visitor: {
      ArrowFunctionExpression(path) {
        // In some conversion cases, it may have already been converted to a function while this callback
        // was queued up.
        if (!path.isArrowFunctionExpression()) return;

        path.arrowFunctionToExpression({
          // While other utils may be fine inserting other arrows to make more transforms possible,
          // the arrow transform itself absolutely cannot insert new arrow functions.
          allowInsertArrow: false,
          noNewArrows,

          // TODO(Babel 8): This is only needed for backward compat with @babel/traverse <7.13.0
          specCompliant: !noNewArrows,
        });
      },
    },
  };
});
```

- ç¬¬ä¸€æ­¥ï¼Œæ‰§è¡Œè¯¥æ’ä»¶ï¼Œè·å–åˆ°åŒ…å«visitorå¯¹è±¡
- ç¬¬äºŒæ­¥ï¼Œ`AST` éå†èŠ‚ç‚¹ï¼Œæ£€æµ‹nodePathçš„type === 'ArrowFunctionExpression'ï¼Œå¯»æ‰¾åˆ°vistorå¯¹è±¡çš„ä¸­keyä¸º ArrowFunctionExpressionçš„å‡½æ•°
- ç¬¬ä¸‰æ­¥ï¼Œå°†nodePathä¼ å…¥è¯¥å‡½æ•°è¿›è¡Œè°ƒç”¨ï¼ˆASTåœ¨è¿™æ­¥è¢«ä¿®æ”¹ï¼‰

---

ğŸ¤”æ€è€ƒ: babelä¸»ä½“ç¨‹åºï¼Œæ€ä¹ˆç®¡ç†å¤šä¸ªæ’ä»¶å¯¹åŒä¸€ä¸ªASTèŠ‚ç‚¹ç±»å‹åšè½¬è¯‘å›è°ƒï¼Ÿ

åˆå¹¶æ‰€æœ‰ä½¿ç”¨åˆ°çš„babelæ’ä»¶çš„å±æ€§ï¼š
- é€šè¿‡è§£æbabelçš„é…ç½®æ–‡ä»¶ï¼ˆæˆ–è€…å‘½ä»¤è¡Œ--pluginså‚æ•°ï¼‰ï¼Œè·å–Babelé…ç½®çš„æ‰€æœ‰æ’ä»¶çš„æè¿°
- å°†æ’ä»¶çš„requireè¿›å†…å­˜ï¼Œè·å¾—æ’ä»¶å‡½æ•°ï¼Œå¹¶æ‰§è¡Œæ’ä»¶å‡½æ•°ï¼Œè·å–åˆ°å¤šä¸ªåŒ…å«vistorå­—æ®µå¯¹è±¡ï¼ˆè¯¦ç»†é€»è¾‘ï¼š[@babel/core/src/config/full.js](https://github.com/babel/babel/blob/fa975bf7cd2b9054faaff107a79e41dcaad305b1/packages/babel-core/src/config/full.js)ï¼‰
- å°†å¤šä¸ªåŒ…å«vistorå­—æ®µå¯¹è±¡æ•´åˆæˆä¸€ä¸ªå¤§çš„visitoræºç å±•ç¤ºï¼ˆè¯¦ç»†é€»è¾‘ï¼š[@babel/core/src/transformation/index.js](https://github.com/babel/babel/blob/fa975bf7cd2b9054faaff107a79e41dcaad305b1/packages/babel-core/src/transformation/index.js#L107)ï¼‰ï¼š
- ASTéå†æ—¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ ¹æ® NodeTypeï¼Œæ¥è·å– visitor[NodeType]ï¼Œå¹¶ä¾æ¬¡æ‰§è¡Œ

```js
// @babel/traverse
const visitor = traverse.visitors.merge(
  visitors,
  passes,
  file.opts.wrapPluginVisitorMethod
)
```
![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20221214131255.png)

ğŸ‘† èŠ‚ç‚¹ç±»å‹å¯¹åº”çš„è½¬è¯‘æ’ä»¶é€»è¾‘å˜æˆäº† Array<function(nodePath)>

---

## vue-cli

> å†…éƒ¨æºç æ˜¯æ’ä»¶åŒ–çš„



## Reactæ’ä»¶åŒ–ç»„ä»¶åº“-DevExtreme Reactive

ç›®å‰åŒ…å«äº† Grid / Chart / Scheduler ä¸‰ä¸ªå¤æ‚ç»„ä»¶ï¼Œè¿™ä¸‰ä¸ªç»„ä»¶éƒ½æ˜¯åŸºäºä¸€ä¸ªæ’ä»¶åŒ–æ¡†æ¶è¿›è¡Œå¼€å‘çš„ã€‚

```jsx
import { PluginHost, Plugin, Template, Getter, Action } from '@devexpress/dx-react-core';

export default function PluginRoot(props) {
 const { chidren } = props;
 return <PluginHost>{children}</PluginHost>;
}

export function FeatureA() {
 return (
   <Plugin name="A">
     <Template name="...">...</Template>
     <Getter name="..." />
     <Action name="..." />
   </Plugin>
 );
}
export function FeatureB() {
 return (
   <Plugin name="B">
     <Template>...</Template>
     <Getter name="..." />
     <Action name="..." />
   </Plugin>
 );
}
```

ğŸ‘† ç±»ä¼¼Vuejsæ’æ§½ï¼Œ `pluginæ ‡ç­¾` å†…çš„ `nameæ ‡ç­¾` ä¼šæ’å…¥åˆ°ä¸»ä½“ç¨‹åºçš„ `pluginhostæ ‡ç­¾` å†…çš„ `name` çš„ä½ç½®
```jsx
// App.jsx
import PluginRoot, { FeatrueA, FeatureB, ... FeatureN } from './MyComponnent;'

const App = () => (
 <PluginRoot>
   <FeatureA />
   <FeatureB />
   ...
   <FeatrueN />
 </PluginRoot>
);

ReactDOM.render(<App />, rootNode);
```

## å‚è€ƒèµ„æ–™

- [å‰ç«¯é¢†åŸŸçš„æ’ä»¶å¼è®¾è®¡](https://mp.weixin.qq.com/s/_Qy8wScgq86vLBwNU-tTfw)
- [æ’ä»¶å¼å¯æ‰©å±•æ¶æ„è®¾è®¡å¿ƒå¾—](https://zhuanlan.zhihu.com/p/372381276)
UmiJSï¼Ÿ

- [TODO:å¼‚æ­¥ç»„ä»¶è®¾è®¡](./å¼‚æ­¥ç»„ä»¶è®¾è®¡.md)