åœ¨ [é‡å­¦vue-01æ¨¡æ¿è¯­æ³•](./é‡å­¦vue-01æ¨¡æ¿è¯­æ³•.md) ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº†Vueå¯¹å¤–çš„ç‰ˆæœ¬åˆ†ä¸ºå®Œæ•´ç‰ˆå’Œruntimeç‰ˆï¼Œå®Œæ•´ç‰ˆæ¯”runtimeç‰ˆå¤šäº†æ¨¡æ¿ç¼–è¯‘å™¨

> ç”¨æ‰“åŒ…å·¥å…·æ—¶ï¼Œæœ€ç»ˆæ‰“å¥½çš„åŒ…é‡Œå®é™…ä¸Šæ˜¯ä¸éœ€è¦ç¼–è¯‘å™¨çš„ï¼Œæ‰€ä»¥åªç”¨è¿è¡Œæ—¶ç‰ˆæœ¬å³å¯.
> 
> å› ä¸ºè¿è¡Œæ—¶ç‰ˆæœ¬ç›¸æ¯”å®Œæ•´ç‰ˆä½“ç§¯è¦å°å¤§çº¦ 30%ï¼Œæ‰€ä»¥åº”è¯¥å°½å¯èƒ½ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬,æ‰“åŒ…å·¥å…·å¼•å…¥çš„èµ„æºé»˜è®¤æ˜¯è¿è¡Œæ—¶ç‰ˆæœ¬çš„

è¿™å¤§å‡ºæ¥30%çš„ç¼–è¯‘å™¨ï¼Œèƒ½è®©æˆ‘ä»¬å†™`templateå­—ç¬¦ä¸²`,åœ¨æµè§ˆå™¨è¿è¡Œæ—¶è§£ææˆ `renderå‡½æ•°` å†æ‰§è¡Œç”Ÿæˆ `VNode`ï¼Œæ¸²æŸ“ç”Ÿæˆ `çœŸå®DOM`

æˆ‘ä»¬å°è¯•å®ç°è¿™éƒ¨åˆ†çš„ç¼–è¯‘å™¨(`templateå­—ç¬¦ä¸²` -> `renderå‡½æ•°ä½“`)
åˆ†æé˜¶æ®µ
- è§£æå™¨
- ä¼˜åŒ–å™¨
- ä»£ç ç”Ÿæˆå™¨

## è§£æå™¨
> æŠŠæ¨¡æ¿å­—ç¬¦ä¸²è§£æå±‚ASTå¯¹è±¡
```js
class compiler {
  constructor(template) {
    this.init(template)
  }
  parseHTML(template,hookObj) {
    console.log(template)
  }
  init(template) {
    this.parseHTML(template,{
      startHook() { console.log('startHook') }, // æ ‡ç­¾å¼€å§‹æ—¶è§¦å‘é’©å­
      endHook() {}, // æ ‡ç­¾ç»“æŸæ—¶è§¦å‘é’©å­
      stringHook() {}, // å­—ç¬¦ä¸²æ—¶è§¦å‘é’©å­
      commentHook() {}, // æ³¨é‡Šæ—¶è§¦å‘é’©å­
    })
  }
}
new compiler('<div>1</div>')
```
è§£æå™¨çš„å†…éƒ¨åŸç†æ˜¯ä¸€å°æ®µä¸€å°æ®µåœ°æˆªå–æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œæ¯æˆªå–ä¸€å°æ®µå­—ç¬¦ä¸²ï¼Œå°±ä¼šæ ¹æ®æˆªå–å‡ºæ¥çš„å­—ç¬¦ä¸²ç±»å‹è§¦å‘ä¸åŒçš„é’©å­å‡½æ•°ï¼Œç›´åˆ°æ¨¡æ¿å­—ç¬¦ä¸²æˆªç©ºåœæ­¢è¿è¡Œ

## ä¼˜åŒ–å™¨
> éå†ASTæ ‡è®°é™æ€èŠ‚ç‚¹

```js
optimize (AST) {
  if (!AST) return
  // ç¬¬ä¸€æ­¥ï¼šæ ‡è®°æ‰€æœ‰é™æ€èŠ‚ç‚¹
  markStatic(AST)
  // ç¬¬äºŒæ­¥ï¼šæ ‡è®°æ‰€æœ‰é™æ€æ ¹èŠ‚ç‚¹
  markStaticRoots(AST)
}
```

## ä»£ç ç”Ÿæˆå™¨
> éå†AST ç”Ÿæˆå¹¶æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œ`new Function`åˆ›å»ºå‡ºrenderå‡½æ•°


## æ‰“åŒ…å·¥å…·çš„ç¼–è¯‘
> é™¤äº†ğŸ‘†å®Œæ•´ç‰ˆvueé‡Œæœ‰æ¨¡ç‰ˆè¯­æ³•çš„ç¼–è¯‘å™¨,ä¾é æ‰“åŒ…å·¥å…·æ¥ç¼–è¯‘çš„æ¨¡æ¿è¯­æ³•çš„ç¼–è¯‘å™¨ï¼Œæˆ‘ä»¬ä¹Ÿæ¥çœ‹çœ‹

åŒæ ·çš„`vue-loader`ï¼Œè§£æå‡º`.vue`æ–‡ä»¶ä¸­çš„`template`éƒ¨åˆ†å‡ºæ¥åï¼Œä¼šè¿›è¡Œè½¬è¯‘æˆASTï¼Œæ‰“æ ‡è®°ï¼Œç”Ÿæˆrenderå­—ç¬¦ä¸²ç­‰æ­¥éª¤

æ€è€ƒğŸ¤”: templateé…ç½®çš„é‚£ç§å†™æ³•ä¹Ÿæ˜¯vue-loaderåšçš„ç¼–è¯‘å—