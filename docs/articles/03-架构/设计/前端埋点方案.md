
ä¸ºäº†çµæ´»åº¦å’Œæ–¹ä¾¿ï¼Œä¸€èˆ¬é¡¹ç›®ç»“åˆ`è‡ªåŠ¨åŸ‹ç‚¹`å’Œ`æ‰‹åŠ¨åŸ‹ç‚¹`

## æ‰‹åŠ¨åŸ‹ç‚¹

æ‰‹åŠ¨åŸ‹ç‚¹çš„é‡ç‚¹åº”è¯¥åœ¨äº å£°æ˜å¼ apiå½¢å¼è°ƒç”¨, å¤„ç†å¥½å‚æ•°å¤„ç†å’Œä¸Šé€å³å¯

è€Œåœ¨ Vue é‡Œåˆ™å¯ä»¥è€ƒè™‘è‡ªå®šä¹‰æŒ‡ä»¤æ¥å°è£…

```js
/**
 * å‘é€è¯·æ±‚ï¼Œä½¿ç”¨imageæ ‡ç­¾è·¨åŸŸ
 * @param url æ¥å£åœ°å€
 */
function sendRequest(url) {
    if (page.length === 0) {
        console.error('è¯·é…ç½®æœ‰æ•ˆçš„pageå‚æ•°', '@burying-point');
        return;
    }
    var img = new Image();
    img.src = url;
}
```        


## è‡ªåŠ¨åŸ‹ç‚¹

ğŸ¤” åœ¨ vue3 é‡Œç”¨ use çš„å½¢å¼åŸºäºæ‰‹åŠ¨åŸ‹ç‚¹å°è£…é€šç”¨çº§åˆ«çš„åŸ‹ç‚¹ä¹Ÿå¾ˆå®¹æ˜“ = = é‚£è¿˜éœ€è¦è‡ªåŠ¨åŸ‹ç‚¹å…¨æ”¶é›†å—

- é¡µé¢åˆ‡æ¢æ—¶ï¼Œè¿›è¡Œé‡‡é›†ï¼Œå³ url å˜åŒ–æ—¶è§¦å‘çš„äº‹ä»¶ï¼›
- é¡µé¢å¤±å»ç„¦ç‚¹ï¼Œå¾—åˆ°ç„¦ç‚¹æ—¶ï¼Œè¿›è¡Œé‡‡é›†ã€‚å³ focusï¼Œblur äº‹ä»¶ï¼›
- é¡µé¢é€šè¿‡æµè§ˆå™¨ tab åˆ‡æ¢ç¦»å¼€ï¼Œåˆ‡æ¢å›æ¥æ—¶ï¼Œè¿›è¡Œé‡‡é›†ï¼Œå³ visibilitychange äº‹ä»¶ï¼›

å› ä¸ºå•é¡µå¤šé¡µçš„é¡µé¢ç”Ÿå‘½å‘¨æœŸä¸åŒï¼Œå®ç°è®¿é—®é‡çš„è‡ªåŠ¨åŸ‹ç‚¹çš„è®¾è®¡æ–¹å‘å°±æ˜¯ `url` çš„å˜åŒ–(å•é¡µå¤šé¡µéƒ½ä¼šå˜åŒ–)

1. urlå˜åŒ– = `window.location.origin + window.location.pathname + window.location.hash` è¿™ä¸‰éƒ¨åˆ†çš„ä»»ä¸€éƒ¨åˆ†å˜åŒ–ï¼Œå³ä¸º url å˜åŒ–ï¼Œå¹¶ä¸åŒ…æ‹¬ `window.location.search` è¿™éƒ¨åˆ†çš„å˜åŒ–ï¼›
2. åœ¨ SPA ä¸­ï¼Œå¦‚æœä¸€ä¸ªé¡µé¢å†…æœ‰å¤šä¸ª tab(åµŒå¥—å­è·¯ç”±)ï¼Œå½“åˆ‡æ¢ tab æ—¶ï¼Œå¼€å‘è€…ä¹Ÿæ”¹å˜ä»–çš„ url çš„ `window.location.pathname`ï¼Œæ­¤æ—¶ä¹Ÿä¼šè®¤ä¸ºæ˜¯é¡µé¢åˆ‡æ¢ï¼Œä¹Ÿä¼šäº§ç”Ÿä¸ŠæŠ¥æ•°æ®(å¸Œæœ›çš„æ•ˆæœæ˜¯åˆ‡æ¢é¡µé¢å†…çš„Tabä¸å±äºè®¿é—®é‡çš„åŸ‹ç‚¹)

ğŸ‘‡ `history api` å¦‚ `pushstate,replacestate` è‡ªå®šä¹‰äº‹ä»¶ï¼Œå› ä¸º BOM å¹¶æ²¡æœ‰æä¾›ç›¸å…³çš„ api æ”¯æŒ EventListener(ä¼ é€’å›è°ƒæ¥æ”¯æŒæ‹“å±•), éœ€è¦è‡ªè¡Œå°è£…ä½¿ç”¨
```js
/**
 * æ‹¼æ¥é€šç”¨åŒ–ä¸ŠæŠ¥å‚æ•°
 * @param {string} é‡å†™è·¯ç”±äº‹ä»¶ç±»å‹
 */
function resetHistoryFun(type){
  // å°†åŸå…ˆçš„æ–¹æ³•å¤åˆ¶å‡ºæ¥
  let originMethod = window.history[type]
  // å½“window.history[type]å‡½æ•°è¢«æ‰§è¡Œæ—¶ï¼Œè¿™ä¸ªreturnå‡ºæ¥çš„å‡½æ•°å°±ä¼šè¢«æ‰§è¡Œ
  return function(){
    // æ‰§è¡ŒåŸå…ˆçš„æ–¹æ³•
    let rs = originMethod.apply(this, arguments)
    // ç„¶åè‡ªå®šä¹‰äº‹ä»¶
    let e = new Event(type.toLocaleLowerCase())
    // å°†åŸå…ˆå‡½æ•°çš„å‚æ•°ç»‘å®šåˆ°è‡ªå®šä¹‰çš„äº‹ä»¶ä¸Šå»ï¼ŒåŸå…ˆçš„æ˜¯æ²¡æœ‰çš„
    e.arguments = arguments
    // ç„¶åç”¨window.dispatchEvent()ä¸»åŠ¨è§¦å‘
    window.dispatchEvent(e)
    return rs;
  }
}
window.history.pushState = resetHistoryFun('pushState') // è¦†ç›–åŸæ¥çš„pushStateæ–¹æ³•
window.history.replaceState = resetHistoryFun('replaceState') // è¦†ç›–åŸæ¥çš„replaceStateæ–¹æ³•

window.addEventListener('pushstate', reportBothEvent)
window.addEventListener('replacestate', reportBothEvent)
```

ğŸ‘† å’Œå¾®å‰ç«¯é‡å†™routerçš„æ€è·¯ä¸€æ ·.... å¤šé¡µå‘¢ï¼Ÿurlä¸Šå‚æ•°éƒ¨åˆ†å‘¢? åµŒå¥—å­è·¯ç”±å‘¢?


```js
window.addEventListener('focus', ()=>{
  console.log('é¡µé¢å¾—åˆ°ç„¦ç‚¹')
});

window.addEventListener('blur', ()=>{
  console.log('é¡µé¢å¤±å»ç„¦ç‚¹')
})
```

```js
document.addEventListener('visibilitychange',  () => {
  if(document.hidden) {
    console.log('é¡µé¢ç¦»å¼€')
  } else {
    console.log('é¡µé¢è¿›å…¥')
  }
})
```


æ•°æ®ä¸ŠæŠ¥æ–¹å¼æ˜¯ `XMLHttpRequest` `window.navigator.sendBeacon` åŸºäº h5sdk ä¸ŠæŠ¥é€»è¾‘æ¶æ„ã€‚

